webpackJsonp([0],{1053:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t){var n=null,o=function(){null!==n&&(clearTimeout(n),n=null)},a=function(){var a=this,r=arguments;o(),n=setTimeout(function(){e.apply(a,r)},t)};return a.abort=o,a}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function m(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function p(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.times,o=void 0===n?3:n,a=t.delay,r=void 0===a?1e3:a,i=t.shouldRetry,s=void 0===i?Q:i,c=t.cancellationToken,l=void 0===c?Z.token:c,u=0;return new Promise(function(t,n){!function a(){if(l.isCancelled())return void n(new J);e().then(function(e){l.throwIfCancelled(),t(e)}).catch(function(e){l.throwIfCancelled(),u<o&&s(e)?(u++,setTimeout(a,r)):n(e)}).catch(n)}()})}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function b(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function C(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function k(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function O(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function I(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function S(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function T(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function N(){return N=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},N.apply(this,arguments)}function j(e){return function(t){return function(n){function o(t){S(this,o);var n=_(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,t));n.handleChange=function(){n.forceUpdate()};var a=n.props.uploadManager,r=e(n.props),i=r.type,s=r.value;return n.session=a.getSession(i,s),n}return T(o,n),ke(o,[{key:"componentDidMount",value:function(){this.session.addListener("change",this.handleChange),this.forceUpdate()}},{key:"componentWillUnmount",value:function(){this.session.removeListener("change",this.handleChange)}},{key:"render",value:function(){return we.a.createElement(t,N({},this.props,{session:this.session}))}}]),o}(Ee.Component)}}var R=n(34),x=function(e){function t(e,n){o(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"UploadError("+e+"): "+n));return r.name="UploadError",r.type=e,r.payload=n,r}return r(t,e),t}(Error),A=x,L=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},D=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),M={start:"handleStart",abort:"handleAbort",complete:"handleComplete",error:"handleError"},F=function(e){function t(e,n){i(this,t);var o=s(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.state={uploading:!1,error:!1,errorData:null,aborted:!1,completed:!1,result:null},o.shouldUpdate=!1,o.update=o.updateImmediately,o.value=e,o.props=n,o.abort=l(o.abort,0),Object.keys(M).forEach(function(e){var t=o[M[e]];t&&o.on(e,t)}),o.on("error",function(e){setTimeout(function(){throw e},0)}),o}return c(t,e),D(t,[{key:"mergeState",value:function(e){this.state=L({},this.state,e)}},{key:"updateBatched",value:function(e){this.shouldUpdate=!0,this.mergeState(e)}},{key:"updateImmediately",value:function(e){this.mergeState(e),this.emit("change")}},{key:"batchUpdate",value:function(e){if(this.update===this.updateBatched)return void e();this.shouldUpdate=!1,this.update=this.updateBatched;try{e()}finally{this.update=this.updateImmediately}this.shouldUpdate&&this.emit("change")}},{key:"start",value:function(){var e=this;this.abort.abort&&this.abort.abort(),this.state.uploading||this.state.completed||this.batchUpdate(function(){e.update({uploading:!0,error:!1,errorData:null,aborted:!1}),e.emit("start")})}},{key:"abort",value:function(){var e=this;this.state.uploading&&this.batchUpdate(function(){e.update({uploading:!1,aborted:!0}),e.emit("abort")})}},{key:"complete",value:function(e){var t=this;this.abort.abort&&this.abort.abort(),this.state.uploading&&this.batchUpdate(function(){t.update({uploading:!1,completed:!0,result:e}),t.emit("complete",e)})}},{key:"error",value:function(e){var t=this;this.abort.abort&&this.abort.abort(),this.state.uploading&&this.batchUpdate(function(){var n=e&&"UploadError"===e.name?e:new A("unknown",e);t.update({uploading:!1,error:!0,errorData:n}),t.emit("error",n)})}}]),t}(R.EventEmitter),U=F,B=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},V=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),q=function(e){return new Promise(function(t,n){return setTimeout(n,e)})},z=function(e){function t(){var e,n,o,a;u(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=m(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state=B({},o.state,{imageReady:!1,image:null}),a=n,m(o,a)}return p(t,e),V(t,[{key:"handleStart",value:function(){var e=this;if("file"===this.value.type){var t=new FileReader;t.addEventListener("load",function(){e.update({imageReady:!0,image:t.result})}),t.readAsDataURL(this.value.value)}else this.update({imageReady:!0});Promise.race([this.props.uploadImage(this.value.value),q(9e4)]).then(function(t){e.state.aborted||e.complete(t)}).catch(function(t){e.state.aborted||e.error(t)})}}]),t}(U),W=z,G=n(61),K=n.n(G),H=n(35),$=n.n(H),J=function e(){d(this,e)},Y=function e(t){var n=this;d(this,e),this.isCancelled=function(){return n.cts.isCancelled},this.throwIfCancelled=function(){if(n.isCancelled())throw new J},this.cts=t},Z=function e(){var t=this;d(this,e),this.isCancelled=!1,this.token=new Y(this),this.cancel=function(){t.isCancelled=!0}};Z.token=(new Z).token;var Q=function(){return!0},X=n(221),ee=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},te=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),ne=3,oe=5e3,ae="zhihu-video-input",re={url:"https://lens.zhihu.com/api/v2/ali_oss_callback",body:"bucket=${BUCKET}&object=${object}&etag=${etag}&size=${size}"},ie=2e5,se=K()(X.a),ce=function(e){function t(){var e,n,o,a;h(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=v(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state=ee({},o.state,{uploadingType:null,uploadTime:0,transcodeTime:0,uploadedSize:0,uploadId:"",fileSize:o.value.size}),o.video=null,o.videoInfo=null,o.checkpoint=null,o.expireTimes=0,o.handleVideoUploadSuccess=function(){return o.handleUploadingStatus("UPLOADING_SUCCESS").then(function(){o.update({uploadingType:"convert",uploadTime:Date.now()-o.previousTime}),o.previousTime=Date.now()}).then(o.checkVideoStatus).then(function(){o.timer&&clearTimeout(o.timer)}).then(function(){o.update({transcodeTime:Date.now()-o.previousTime})}).then(o.loadVideoInfo).then(function(){o.token.throwIfCancelled(),o.complete(o.videoInfo)})},o.handleThrowError=function(e){o.token.throwIfCancelled(),o.error(e)},o.handleProgress=function(e,t){return function(n){var a=t.uploadId,r=o.value.size*e;o.update({uploadedSize:r,uploadId:a}),o.checkpoint=t,0===e&&o.handleUploadingStatus("UPLOADING_START"),e/.1%1==0&&o.handleUploadingStatus("UPLOADING"),n()}},o.handleResume=function(){var e=o.video.uploadfile[0].object_key;return o.getClient().then(function(){var t=o.expireObjectKey&&o.expireObjectKey!==e;return t&&(o.expireObjectKey=""),o.client.multipartUpload(e,o.value,{progress:o.handleProgress,parallel:ne,callback:re,checkpoint:t?null:o.checkpoint,timeout:ie})})},o.handleUploadingStatus=function(e){var t=o.state.uploadId,n=o.video.uploadfile[0],a=n.video_id,r=n.object_key;return o.load("https://lens.zhihu.com/api/v2/videos/"+a+"/uploading_status",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({object_key:r,upload_id:t,video_source:"origin",upload_event:e})})},o.handleReport=function(e){var t=o.state,n=t.fileSize,a=t.uploadId,r=e.payload||{},i=r.requestId,s=r.code,c=r.message,l=r.status,u=o.video.uploadfile[0],m=u.video_id,p=u.object_key,d={msg:"upload",platform:"web",uploadid:a,videoid:m,requestid:i,object:p,filesize:n,url:location.href,errorcode:s,errormsg:c||JSON.stringify(e),errorstatus:l};o.load("https://lens.zhihu.com/report?"+$.a.stringify(d))},o.getClient=function(){var e=o.video.uploadtoken,t=e.access_id,n=e.access_key,a=e.access_token;return se("https://unpkg.zhimg.com/ali-oss@5.3.0/dist/aliyun-oss-sdk.min.js").then(function(){o.client=new window.OSS.Wrapper({endpoint:"https://upload-oss.vzuu.com",cname:!0,bucket:ae,secure:!0,accessKeyId:t,accessKeySecret:n,stsToken:a})})},o.createVideo=function(){if(o.state.fileSize<=102400)throw new A("video-uploading-entity-small");return o.token.throwIfCancelled(),o.video&&!o.expireObjectKey?Promise.resolve():f(function(){return o.load("https://lens.zhihu.com/api/v2/videos",{method:"POST",headers:{"Content-Type":"application/json","X-Upload-Content-Type":o.value.type,"X-Upload-Content-Length":o.value.size},body:JSON.stringify({use_watermark:o.props.videoWatermark,video_count:1})})},{cancellationToken:o.token}).then(function(e){o.token.throwIfCancelled(),o.video=ee({},e)}).catch(function(e){throw o.token.throwIfCancelled(),new A("upload",e)})},o.uploadVideo=function(){var e=o.video.uploadfile,t=e[0].object_key;if(o.token.throwIfCancelled(),o.checkpoint)return o.update({uploadingType:"upload",error:!1,uploading:!0}),f(o.handleResume).catch(function(e){if(e&&e.payload&&"NoSuchUpload"===e.payload.code)return void o.handleVideoUploadSuccess().catch(o.handleThrowError).catch(function(){});throw o.token.throwIfCancelled(),new A("upload",e)}).then(o.handleVideoUploadSuccess).catch(o.handleThrowError).catch(function(){});return o.getClient().then(function(){return o.client.multipartUpload(t,o.value,{progress:o.handleProgress,mime:o.value.type,parallel:ne,callback:re,timeout:ie,partSize:1048576}).catch(function(){return f(o.handleResume)}).catch(function(e){throw"SecurityTokenExpired"===e.code&&0===o.expireTimes&&(o.expireTimes=o.expireTimes+1,o.expireObjectKey=t,o.handleStart()),o.token.throwIfCancelled(),new A("upload",e)})})},o.checkVideoStatus=function(){return new Promise(function(e,t){!function n(){if(o.token.isCancelled())return void t(new J(o.token));var a=o.video.uploadfile[0].video_id;o.load("https://lens.zhihu.com/api/videos/"+a+"/uploading_status").then(function(t){if(o.token.throwIfCancelled(),t.is_completed)e();else{if("failure"===t.converting_status)throw new A("convert",t);o.timer=setTimeout(n,oe)}}).catch(function(e){if(o.token.throwIfCancelled(),e&&"UploadError"===e.name)throw e;if(e&&e.error)throw new A("custom",e.error);o.timer=setTimeout(n,oe)}).catch(t)}()})},o.loadVideoInfo=function(){o.token.throwIfCancelled();var e=o.video.uploadfile[0].video_id;return f(function(){return o.load("https://lens.zhihu.com/api/videos/"+e)},{cancellationToken:o.token}).then(function(e){o.token.throwIfCancelled();var t=e.thumbnail,n=e.cover_info;o.videoInfo={id:e.id,thumbnail:n?n.thumbnail:t}}).catch(function(e){throw o.token.throwIfCancelled(),new A("unknown",e)})},a=n,v(o,a)}return y(t,e),te(t,[{key:"handleStart",value:function(){var e=this;this.cts=new Z,this.token=this.cts.token,this.update({uploadingType:"upload",uploadedSize:0}),Promise.resolve().then(this.createVideo).then(function(){e.token.throwIfCancelled(),e.previousTime=Date.now()}).then(this.uploadVideo).then(this.handleVideoUploadSuccess).catch(this.handleThrowError).catch(function(){})}},{key:"handleAbort",value:function(){this.update({uploadedSize:0}),this.handleUploadingStatus("CANCEL"),this.cts.cancel(),this.client.cancel(),this.video=null}},{key:"handleError",value:function(e){this.update({uploadedSize:0}),window.Raven&&window.Raven.captureException&&(e.name=e.name+" video_error_"+this.expireTimes,window.Raven.captureException(e,{fingerprint:["upload video error"]})),"convert"!==e.type&&"upload"!==e.type||(this.handleUploadingStatus("UPLOADING_FAILURE"),this.handleReport(e))}},{key:"load",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch(e,ee({},t,{headers:ee({},t.headers,{Accept:"application/json"}),credentials:"include"})).then(function(e){return e.json().catch(function(){return{}}).then(function(t){if(!e.ok)throw t;return t})})}}]),t}(U),le=ce,ue=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),me=function(e){function t(){return b(this,t),g(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return C(t,e),ue(t,[{key:"handleStart",value:function(){var e=this;this.props.uploadEmbeddedVideo(this.value).then(function(t){e.state.aborted||e.complete(t)}).catch(function(t){e.state.aborted||e.error(t)})}}]),t}(U),pe=me,de=n(103),fe=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),he=function(e){function t(){return E(this,t),w(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return k(t,e),fe(t,[{key:"handleStart",value:function(){var e=this,t=new FormData;t.append("document",this.value),Object(de.b)("https://www.zhihu.com/api/v4/document_convert",{method:"POST",body:t}).then(function(e){return e instanceof Response?Object(de.c)(e):e}).then(function(t){e.state.aborted||e.complete(t)}).catch(function(t){e.state.aborted||e.error(t)})}}]),t}(U),ve=he,ye={image:W,video:le,document:ve,"embedded-video":pe},be=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),ge=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};O(this,t);var n=P(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.handleUploadStart=function(){0===n.uploadingCount&&n.emit("start"),n.uploadingCount++},n.handleUploadEnd=function(){0===--n.uploadingCount&&n.emit("end")},n.handleUploadError=function(){for(var e=arguments.length,t=Array(e),o=0;o<e;o++)t[o]=arguments[o];n.emit.apply(n,["error"].concat(t))},n.props=e,n.sessions={},Object.keys(ye).forEach(function(e){n.sessions[e]=new Map}),n.uploadingCount=0,n}return I(t,e),be(t,[{key:"createSession",value:function(e,t){var n=this,o=new ye[e](t,this.props);return o.on("error",function(t){try{n.handleUploadError(t,e,o)}catch(e){}}),o.on("start",this.handleUploadStart),o.on("abort",this.handleUploadEnd),o.on("complete",this.handleUploadEnd),o.on("error",this.handleUploadEnd),this.sessions[e].set(t,o),o}},{key:"getSession",value:function(e,t){return this.sessions[e].get(t)||this.createSession(e,t)}}]),t}(R.EventEmitter),Ce=ge,Ee=n(0),we=n.n(Ee),ke=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Oe=j;n.d(t,"b",function(){return Ce}),n.d(t,"a",function(){return Oe})},1078:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var i=n(0),s=n.n(i),c=n(2),l=n.n(c),u=n(31),m=n(5),p=n(37),d=n(7),f=n(3),h=n(386),v=n(1053),y=n(1079),b=(n.n(y),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),g=function(e){return new Promise(function(t){setTimeout(t,e)})},C=function(e){return new Promise(function(t,n){var o=new Image;o.onload=t,o.onerror=n,o.src=e})},E=function(e){function t(){var e,n,r,i;o(this,t);for(var s=arguments.length,c=Array(s),l=0;l<s;l++)c[l]=arguments[l];return n=r=a(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),r.handleStart=function(){var e=r.props,t=e.session.value,n=e.data,o=n.rawWidth,a=n.rawHeight,i=r.imgNode;"file"===t.type&&"image/gif"===t.value.type&&(m.a.setModule(i,{module:"GifItem"},{card:{content:{type:"Gif"}}}),m.a.trackEvent(i,{action:"Upload"},{gif:{gif_bytes:t.value.size,gif_hight:a,gif_width:o}}))},r.handleError=function(e){r.props.onImageUploadError&&r.props.onImageUploadError(e)},r.handleComplete=function(e){var t=r.props.session.value,n=e.url,o=e.rawWidth,a=e.rawHeight,i=e.watermark,s=e.originalSrc,c=e.watermarkSrc,l=e.privateWatermarkSrc,d=r.imgNode;"file"===t.type&&"image/gif"===t.value.type&&m.a.trackEvent(d,{action:"StatusReport"},{status:{event:{action:"Upload",path:[{module:"GifItem"}]},result:"Success"},gif:{gif_bytes:t.value.size,gif_hight:a,gif_width:o}});var f=Object(u.a)(n,{quality:Object(p.a)(navigator.userAgent).Mobile?50:80,size:"hd"});Promise.race([C(f),g(500)]).catch(function(){}).then(function(){r.props.onImageUploaded&&r.props.onImageUploaded({src:f,rawWidth:o,rawHeight:a,watermark:i,originalSrc:s,watermarkSrc:c,privateWatermarkSrc:l})})},r.handleRetry=function(){r.props.session.start()},i=n,a(r,i)}return r(t,e),b(t,[{key:"componentDidMount",value:function(){var e=this.props.session;e.addListener("start",this.handleStart),e.addListener("error",this.handleError),e.addListener("complete",this.handleComplete),e.state.error||e.start()}},{key:"componentWillUnmount",value:function(){var e=this.props.session;e.removeListener("start",this.handleStart),e.removeListener("error",this.handleError),e.removeListener("complete",this.handleComplete),e.abort()}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.onClick,a=t.onMouseDown,r=t.session,i=r.state;return i.imageReady?s.a.createElement("div",{className:"Editable-imageUploader",ref:function(t){return e.imgNode=t}},s.a.createElement("div",{className:l()("Editable-imageUploader-layout",{"is-fullWidth":!i.image},n),onClick:o,onMouseDown:a},i.image?s.a.createElement("img",{className:"Editable-imageUploader-image",src:i.image,alt:"图片"}):s.a.createElement("div",{className:"Editable-imageUploader-placeholder"}),s.a.createElement("div",{className:l()("Editable-imageUploader-status",{"is-error":i.error})},s.a.createElement("div",{className:"Editable-imageUploader-statusText"},i.uploading&&"图片上传中",i.error&&"图片上传失败"),i.error&&s.a.createElement("div",{className:"Editable-imageUploader-retry"},s.a.createElement(f.c,{preset:"link",icon:d._5,label:"重试",onClick:this.handleRetry}))),i.uploading&&s.a.createElement("div",{className:"Editable-imageUploader-progress"},s.a.createElement(h.a,{active:!0})),i.error&&s.a.createElement("div",{className:"Editable-imageUploader-progress is-error"}))):s.a.createElement("div",{className:"Editable-imageUploader",ref:function(t){return e.imgNode=t}})}}]),t}(i.Component);t.a=Object(v.a)(function(e){return{type:"image",value:e.data.upload}})(E)},1079:function(e,t){},1085:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}var a=n(394),r=o(a),i=n(395),s=o(i);e.exports={TransitionGroup:s.default,CSSTransitionGroup:r.default}},1086:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var l,u,m=n(0),p=n.n(m),d=n(2),f=n.n(d),h=n(1135),v=n.n(h),y=n(3),b=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),g=function(e){function t(){var e,n,r,i;o(this,t);for(var s=arguments.length,c=Array(s),l=0;l<s;l++)c[l]=arguments[l];return n=r=a(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),r.handleClick=function(){var e=r.props;(0,e.clickCallback)(e.page)},i=n,a(r,i)}return r(t,e),b(t,[{key:"render",value:function(){var e=this.props,t=e.text,n=e.isCurrent,o=e.className;return p.a.createElement(y.c,{preset:y.b.Plain,className:f()("PaginationButton",{"PaginationButton--current":n},o),onClick:this.handleClick,disabled:n},t)}}]),t}(m.Component),C=(n(1138),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),E=(u=l=function(e){function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,e),C(t,[{key:"render",value:function(){var e=this.props.current,n=this.props.total,o=this.props.clickCallback,a=this.props.className,r=t.getPagerList(e,n);return p.a.createElement("div",{className:f()("Pagination",a)},1!==e&&1!==n&&p.a.createElement(g,{className:"PaginationButton-prev",clickCallback:o,text:"上一页",page:e-1}),r.map(function(t,n){return"number"==typeof t?p.a.createElement(g,{clickCallback:o,text:t,page:t,key:n,isCurrent:e===t}):p.a.createElement("span",{key:n,className:"PaginationButton PaginationButton--fake"},t)}),e!==n&&p.a.createElement(g,{className:"PaginationButton-next",clickCallback:o,text:"下一页",page:e+1}))}}],[{key:"getPagerList",value:function(e,t){return t<6?v()(1,t+1):e>=t-2?[1,"..."].concat(v()(t-3,t+1)):e<=3?v()(1,5).concat(["...",t]):[1,"..."].concat(v()(e-1,e)).concat(["...",t])}}]),t}(m.Component),l.defaultProps={current:1,total:1,clickCallback:function(){}},u);n.d(t,"a",function(){return E}),n.d(t,!1,function(){})},1087:function(e,t,n){"use strict";function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.selectedKey,i=void 0===a?"selectedProps":a,s=n.dropedKey,c=void 0===s?"dropedProps":s;return Object.keys(e).reduce(function(n,a){var s=t.includes(a)?i:c;return r({},n,o({},s,r({},n[s],o({},a,e[a]))))},{})}t.a=a;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}},1088:function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(e){return"article"===e?"Post":"book_review"===e?"BookReview":""+e.slice(0,1).toUpperCase()+e.slice(1)}},1121:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}n.d(t,"a",function(){return m});var i=n(0),s=n.n(i),c=n(75),l=n(1408),u=(n.n(l),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),m=function(e){function t(){return o(this,t),a(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return r(t,e),u(t,[{key:"render",value:function(){var e=this.props.onRef;return s.a.createElement("div",{className:"Comments-pattern-loading",ref:e},s.a.createElement(c.a,null))}}]),t}(i.PureComponent)},1135:function(e,t,n){var o=n(1136),a=o();e.exports=a},1136:function(e,t,n){function o(e){return function(t,n,o){return o&&"number"!=typeof o&&r(t,n,o)&&(n=o=void 0),t=i(t),void 0===n?(n=t,t=0):n=i(n),o=void 0===o?t<n?1:-1:i(o),a(t,n,o,e)}}var a=n(1137),r=n(228),i=n(234);e.exports=o},1137:function(e,t){function n(e,t,n,r){for(var i=-1,s=a(o((t-e)/(n||1)),0),c=Array(s);s--;)c[r?s:++i]=e,e+=n;return c}var o=Math.ceil,a=Math.max;e.exports=n},1138:function(e,t){},1139:function(e,t){e.exports={attributes:{width:"72px",height:"58px",viewBox:"0 0 72 58"},content:'<defs>         <path d="M0.00434937116,11.7604183 C0.0014585125,11.8367351 0,11.9134174 0,11.9904392 L0,52.0095608 C0,55.3137533 2.68603825,58 5.99943435,58 L66.0005656,58 C69.3089213,58 72,55.317989 72,52.0095608 L72,11.9904392 C72,8.68624675 69.3139617,6 66.0005656,6 L31.1520961,6 L30.2346555,3.7077864 C29.4154984,1.66113281 26.9585394,0 24.7478675,0 L6.18638069,0 C2.86742525,0 0.139552484,2.68348852 0.0902454792,5.99373937 L0.00434937116,11.7604183 Z" id="path-1"></path>         <mask id="mask-2" maskContentUnits="userSpaceOnUse" maskUnits="objectBoundingBox" x="0" y="0" width="72" height="58" fill="white">             <use xlink:href="#path-1"></use>         </mask>     </defs>     <g id="空状态" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">         <g id="collection" transform="translate(-39.000000, -30.000000)" stroke="#E7EAF1">             <g transform="translate(39.000000, 30.000000)" id="Group-7">                 <g>                     <use id="Combined-Shape" mask="url(#mask-2)" stroke-width="6" xlink:href="#path-1"></use>                     <path d="M36.4126782,38.4800003 L30.2669271,41.2927815 C29.7656337,41.522213 29.4096881,41.2718295 29.4738593,40.716584 L30.2498317,34.0024302 L25.6755762,29.0266708 C25.3024658,28.6208107 25.4306014,28.2049135 25.9785012,28.0943637 L32.6038296,26.7575697 L35.9225353,20.8696 C36.1932338,20.3893332 36.6283715,20.3826781 36.9028211,20.8696 L40.2215268,26.7575697 L46.8468552,28.0943637 C47.3872665,28.2034026 47.5280608,28.6151866 47.1497802,29.0266708 L42.5755247,34.0024302 L43.3514971,40.716584 C43.4147912,41.2642406 43.0666691,41.5253922 42.5584293,41.2927815 L36.4126782,38.4800003 Z" id="Star" stroke-width="3"></path>                 </g>             </g>         </g>     </g>'}},1140:function(e,t){},1406:function(e,t){},1407:function(e,t){},1408:function(e,t){},1409:function(e,t){},1410:function(e,t,n){function o(e,t,n){var o=null==e?0:e.length;if(!o)return-1;var l=o-1;return void 0!==n&&(l=i(n),l=n<0?s(o+l,0):c(l,o-1)),a(e,r(t,3),l,!0)}var a=n(232),r=n(153),i=n(401),s=Math.max,c=Math.min;e.exports=o},1411:function(e,t){},1412:function(e,t){},1413:function(e,t){},1414:function(e,t){},1415:function(e,t){},1416:function(e,t){},1417:function(e,t){},1418:function(e,t){},1419:function(e,t){},1423:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){switch(e){case"answer":return Object(B.c)(t);case"article":return Object(V.b)(t);default:return null}}function s(e,t){var n=t.parent,o=t.parent,a=o.type,r=o.id,i=t.status,s=t.order,c=t.byComment,l=t.commentPattern,u=e.entities,m=e.comments,p=a+"_"+r,d=m.parent,f=m.pagination;"reviewing"===i&&(f=m.reviewing),"reverse"===s&&"open"===i&&(f=m.reverse);var h=[],v=m.collapsed[p]||{};v&&v.ids&&v.ids.length>0&&(h=v.ids.map(function(e){return u.comments[e]}));var y=f[p]||{isPrevDrained:!1,isFetching:!1,isDrained:!1,ids:[]},b=y.isFetching,g=y.isPrevDrained,C=y.isDrained,E=y.ids,w=y.newIds,k=void 0===w?[]:w;return{isFetching:b,isPrevDrained:g,isDrained:C,totals:y.totals,comments:("bottom"!==l?E:k).map(function(e){return u.comments[e]}),collapsedInfo:v,collapsedComments:h,targetComment:u.comments[c],parent:$({},n,d[p])}}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function m(e,t){var n=t.commentId,o=e.entities.comments,a=e.comments.conversation,r=a[n]||{isFetching:!1,isDrained:!1,ids:[]};return{isFetching:r.isFetching,isDrained:r.isDrained,comments:r.ids.map(function(e){return o[e]}),openComment:o[n]}}function p(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var v,y,b,g,C,E,w,k=n(1),O=n.n(k),P=n(0),I=n.n(P),S=n(4),_=n(2),T=n.n(_),N=n(62),j=n(1085),R=n(52),x=n(61),A=n.n(x),L=n(7),D=n(73),M=n(1086),F=n(29),U=n(12),B=n(76),V=n(63),q=n(223),z=n(390),W=n(393),G=n(1121),K=n(385),H=(n(1409),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),$=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},J=(y=v=function(e){function t(e,n){o(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return r.state={collapsed:!0,current:1,packupButtonStatus:!1,packupButtonLeft:0},r.handleOpenCollapsed=function(){r.setState({collapsed:!1}),r.load(r.props,!1,!0)},r.createOnRef=A()(function(e){return function(t){var n=r.props.byComment;e===Number(n)&&(r.targetCommentEl=t)}}),r.handlePaginationClick=function(e){var t=r.props.onPaginationClick,n=r.state.current;t&&t(n,e),r.commentsElement.scrollIntoView(),r.setState({current:e}),r.loadByPagination(e)},r.renderComment=function(e){var t=r.props,n=t.parent,o=n.type,a=n.author;a=void 0===a?{isOrg:!1}:a;var i=a.isOrg,s=t.isMobile,c=t.parent,l=t.commentNeedsReview,u=t.onShowConversation,m=t.status,p=t.onItemLike,d=t.onItemDelete,f=t.onItemCollapse,h=t.onItemDislike,v=t.onItemApprove,y=t.canOperateItem,b=t.commentPattern;return I.a.createElement(W.a,{key:e.id,isMobile:s,comment:e,onRef:r.createOnRef(e.id),status:m,type:o,parent:c,canOperate:y,commentNeedsReview:l,onShowConversation:u,ownerAuthorIsOrg:i,onLike:p,onReply:r.addComment,onFeature:r.featureItem,onDelete:d,onCollapse:f,onDislike:h,onApprove:v,commentPattern:b})},r.renderNormalComments=function(e){var t=r.state.collapsed,n=r.props.byComment,o=[];if(r.lastFeaturedIndex=0,e.length>0){var a=e[0].featured,i=!1;e.forEach(function(s,c){if(n||!s.collapsed){var l=e[c-1];if(!s.collapsed||(l&&l.collapsed||o.push(r.renderCollapsedDivider()),!t)){o.push(r.renderComment(s));var u=e[c+1];a&&!i&&s.featured&&(!u||!u.featured)&&(i=!0,r.lastFeaturedIndex=c,o.push(I.a.createElement("div",{className:"CommentList-divider",key:"divider-featured"},I.a.createElement("div",{className:"CommentList-dividerLine"}),I.a.createElement("div",{className:"CommentList-dividerText"},"以上为精选评论",I.a.createElement(L.I,{className:"CommentList-questionMark","data-tooltip":"精选评论包含回答作者推荐的评论和部分高赞评论",center:!0,size:16})))))}}})}return o},r.renderCollapsedComments=function(){var e=[],t=r.props.collapsedComments;return r.state.collapsed||!t||t.length<=0?[]:(e.push(t.map(function(e){return r.renderComment(e)})),e)},r.renderComments=function(e){return e.map(r.renderComment)},r.load=r.load.bind(r),r.loadByPagination=r.loadByPagination.bind(r),r.addComment=r.addComment.bind(r),r.featureItem=r.featureItem.bind(r),r.handleScroll=r.handleScroll.bind(r),r}return r(t,e),H(t,[{key:"componentDidMount",value:function(){this.subscription=Object(R.subscribe)("scroll",this.handleScroll);var e=this.props,t=e.byComment,n=e.commentPattern,o=e.parent.adminClosedComment,a=this.state.current;t&&this.scrollToTarget(),"bottom"!==n||o||(this.loadByPagination(a),this.commentsWithPaginationEl&&this.setState({packupButtonLeft:this.commentsWithPaginationEl.getBoundingClientRect().right-16}))}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.order,o=t.status,a=t.targetComment,r=t.commentPattern;n===e.order&&o===e.status||("bottom"===r?(this.setState({current:1}),this.loadByPagination(1,e)):this.load(e),this.setState({collapsed:!0}));var i=e.targetComment;!a&&i&&this.setState({collapsed:!i.collapsed})}},{key:"componentDidUpdate",value:function(e){!e.comments.length&&this.props.comments.length&&this.props.byComment&&this.scrollToTarget()}},{key:"componentWillUnmount",value:function(){this.props.dispatch(Object(U.e)(U.c)),this.subscription&&this.subscription.unsubscribe()}},{key:"load",value:function(e,t,n){if(!this.props.isFetching&&!this.props.parent.adminClosedComment){var o=e||this.props,a=o.order,r=o.byComment,s=o.status,c=o.parent,l=c.id,u=c.type,m=o.dispatch,p=o.commentPattern;if(o.needLoadCommentPermission&&i(u,l)&&m(i(u,l)),n){m(Object(N.e)(u,l,{order:a,isPrevious:t,byComment:r,status:"collapsed",commentPattern:p},!0))}else m(Object(N.e)(u,l,{order:a,isPrevious:t,byComment:r,status:s,commentPattern:p}))}}},{key:"addComment",value:function(e,t){var n=this.props,o=n.parent,a=o.id,r=o.type,i=n.dispatch,s=[r,a,e];return t&&(s[3]=t.id),i(N.a.apply(void 0,s))}},{key:"featureItem",value:function(e){this.props.onItemFeature(e,this.lastFeaturedIndex)}},{key:"handleScroll",value:function(){if(this.commentsElement&&this.commentsWithPaginationEl){var e=window.innerHeight,t=this.state.packupButtonStatus,n=this.commentsWithPaginationEl.getBoundingClientRect(),o=n.top,a=n.bottom,r=n.height;!t&&r>500&&a>e&&o<0?this.setState({packupButtonStatus:!0}):t&&(r<=500||a<=e||o>=0)&&this.setState({packupButtonStatus:!1})}}},{key:"scrollToTarget",value:function(){var e=this.targetCommentEl,t=this.listEl;if(t&&e){var n=e.getBoundingClientRect(),o=n.top,a=n.height,r=t.getBoundingClientRect(),i=r.top,s=r.height;this.listEl.scrollTop+=o-i-(s-a)/2,e.classList.add("CommentItem--highlighted"),setTimeout(function(){return e.classList.remove("CommentItem--highlighted")},2e3),e.tabIndex=-1,e.focus()}}},{key:"loadByPagination",value:function(e,t){var n=t||this.props,o=n.order,a=n.byComment,r=n.status,s=n.parent,c=s.id,l=s.type,u=n.dispatch,m=n.commentPattern;n.needLoadCommentPermission&&u(i(l,c)),u(Object(N.e)(l,c,{order:o,isPrevious:!1,byComment:a,status:r,commentPattern:m,current:e}))}},{key:"renderCollapsedDivider",value:function(){var e=this.props,t=e.isDrained,n=e.parent.collapsedCounts;return!t||n<=0?[]:this.state.collapsed?I.a.createElement("div",{className:"CommentList-action",key:"collapsed"},I.a.createElement("div",{className:"CommentList-expendCollapseButton"},I.a.createElement("span",{onClick:this.handleOpenCollapsed},Object(F.a)(n)," 条评论被折叠"),"（",I.a.createElement("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）")):I.a.createElement("div",{className:"CommentList-divider",key:"divider-collapsed"},I.a.createElement("div",{className:"CommentList-dividerLine"}),I.a.createElement("div",{className:"CommentList-dividerText"},Object(F.a)(n)," 条评论被折叠（",I.a.createElement("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）"))}},{key:"renderCollapsedInfiLoader",value:function(){var e=this,t=this.state.collapsed;if(t)return[];var n=this.props.collapsedInfo;n=void 0===n?{}:n;var o=n.isFetching,a=n.isPrevDrained,r=n.isDrained;return I.a.createElement(D.b,{className:"CommentList",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:o,isPrevDrained:a,isDrained:r,onLoad:function(n){return e.load(e.props,n,!t)},placeholder:I.a.createElement(D.a,{className:"CommentItem",small:!0})},this.renderCollapsedComments())}},{key:"renderPatternContent",value:function(e){var t=this,n=this.props,o=n.isFetching,a=n.parent.adminClosedComment,r=n.byComment,i=n.status,s=n.order,c=n.totals,l=n.handlePackupButton,u=n.apps,m=Math.ceil(c/20),p=this.state,d=p.current,f=p.packupButtonStatus,h=p.packupButtonLeft;return a?null:o?I.a.createElement(G.a,{onRef:function(e){t.commentsWithPaginationEl=e}}):I.a.createElement("div",{ref:function(e){t.commentsWithPaginationEl=e}},I.a.createElement("div",{className:"CommentList"},"normal"===s&&"open"===i?this.renderNormalComments(e):this.renderComments(e)),m>1&&I.a.createElement(M.a,{current:d,className:"comments-pagination",total:m,clickCallback:this.handlePaginationClick}),!r&&this.renderCollapsedDivider(),!r&&this.renderCollapsedInfiLoader(),I.a.createElement(j.CSSTransitionGroup,{transitionName:"Comments-Packup-Button",transitionEnterTimeout:300,transitionLeaveTimeout:300},f&&"column"!==u&&I.a.createElement("button",{onClick:l,className:"Comments-Packup-Button",style:{left:h}},"收起评论",I.a.createElement(L.f,{center:!0}))))}},{key:"renderModalContent",value:function(e){var t=this,n=this.props,o=n.collapsedInfo,a=n.parent.adminClosedComment,r=n.status,i=n.order,s=n.byComment,c=this.state.collapsed,l=c?this.props:o,u=l.isFetching,m=l.isDrained,p=l.isPrevDrained;if(m&&e.length<=0||a)return I.a.createElement("div",{className:"Comments-empty"},I.a.createElement(q.a,{entityType:"comments"}));var d={getContainer:function(e){return e}};return I.a.createElement(D.b,$({className:"CommentList",onRef:function(e){t.listEl=e},isLocal:!0,isLoading:u,isPrevDrained:p,isDrained:m,onLoad:function(e){return t.load(t.props,e,!c)},placeholder:I.a.createElement(D.a,{className:"CommentItem",small:!0})},d),"normal"===i&&"open"===r?this.renderNormalComments(e):this.renderComments(e),!s&&this.renderCollapsedDivider(),!s&&this.renderCollapsedComments())}},{key:"renderCommentEdit",value:function(){var e=this.props,t=e.parent,n=t.canComment;n=void 0===n?{status:!0}:n;var o=n.status,a=n.reason,r=t.author;r=void 0===r?{isOrg:!1}:r;var i=r.isOrg,s=t.type,c=t.id,l=t.adminClosedComment,u=t.questionType,m=e.byComment,p=e.isAutoblur,d=e.commentNeedsReview,f=l?"当前内容暂时无法评论":a,h=p?!p:!m;return o&&!l?I.a.createElement(z.a,{className:"Comments-footer",type:s,id:c,commentNeedsReview:d,onSubmit:this.addComment,autoFocus:h,ownerAuthorIsOrg:i,ownerAuthorIsBrand:"commercial"===u}):I.a.createElement("div",{className:T()("Comments-disabledText",{"Comments-disabledText--fixed":void 0})},I.a.createElement("div",{className:"Comments-disabledReason"},f))}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.isAuthor,a=t.comments,r=t.commentPattern,i=t.parent,s=i.author;s=void 0===s?{isOrg:!1}:s;var c=s.isOrg,l=i.commentPermission,u=i.reviewingCounts,m=i.commentCount,p=i.adminClosedComment,d=t.totals,f=t.status,h=t.order,v=t.onStatusChange,y=t.apps,b=t.onOrderChange,g=t.targetLink,C=a.filter(function(e){return!e.isDelete}),E="censor"===l&&o,w=E?{isCommentReviewer:E,onStatusChange:v,status:f,reviewingCounts:u}:{status:f},k=T()({Comments:!0,"Comments--withEditor":!0,"Comments-withPagination":"bottom"===r},n);return I.a.createElement("div",{className:k,ref:function(t){e.commentsElement=t}},I.a.createElement(K.a,$({commentCount:void 0!==m?m:d,commentClosed:p,targetLink:g,order:h,onOrderChange:b,commentPattern:r,isOrg:c},w)),"column"===y&&this.renderCommentEdit(),"bottom"===r?this.renderPatternContent(C):this.renderModalContent(C),"column"!==y&&this.renderCommentEdit())}}]),t}(P.Component),v.propTypes={type:O.a.string,parent:O.a.object.isRequired,targetLink:O.a.node,commentNeedsReview:O.a.bool,byComment:O.a.oneOfType([O.a.number,O.a.string]),commentPattern:O.a.string,handlePackupButton:O.a.func,onPaginationClick:O.a.func,isAutoblur:O.a.bool},v.contextTypes={authRequired:O.a.func.isRequired},v.defaultProps={isAutoblur:!1},y),Y=Object(S.connect)(s)(J),Z=n(15),Q=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),X=(g=b=function(e){function t(e,n){c(this,t);var o=l(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,n));return o.load=o.load.bind(o),o.addComment=n.authRequired(o.addComment.bind(o),void 0,U.c),o}return u(t,e),Q(t,[{key:"componentDidMount",value:function(){this.load()}},{key:"load",value:function(){this.props.dispatch(Object(N.f)(this.props.commentId))}},{key:"addComment",value:function(e,t){var n=this.props,o=n.parent,a=o.type,r=o.id,i=n.commentId,s=n.dispatch,c=[a,r,e,t.id,i];return s(N.a.apply(void 0,c))}},{key:"render",value:function(){var e=this.props,t=e.onItemLike,n=e.onItemDelete,o=e.onItemFeature,a=e.onItemApprove,r=e.onItemCollapse,i=e.onItemDislike,s=e.onNavBack,c=e.canOperateItem,l=e.isFetching,u=e.comments,m=e.commentNeedsReview,p=e.openComment.collapsed,d=e.parent,f=e.parent.canComment;f=void 0===f?{status:!0}:f;var h=f.status,v=f.reason,y=e.commentPattern,b=e.commentId,g=this.context.currentUser,C=Boolean(g&&u.find(function(e){return e.author&&e.author.member.urlToken===g.urlToken})),E=void 0,w=void 0;C&&(E=u.filter(function(e){return e.author&&e.author.member.urlToken!==g.urlToken}),w=E[E.length-1]);var k=void 0;return l&&!u.length?k=I.a.createElement(D.a,{className:"CommentItem",small:!0}):u.length&&(k=u.map(function(e,s){return I.a.createElement(W.a,{key:s,isConversation:!0,commentNeedsReview:m,canOperate:c,parent:d,comment:e,onLike:t,onDelete:n,onFeature:o,onApprove:a,onCollapse:r,onDislike:i,collapsedShown:p})})),"bottom"===y?I.a.createElement(Z.b,{size:"fullPage",onClose:s},I.a.createElement("div",{className:"Comments"},I.a.createElement(K.a,{isConversation:!0,commentPattern:y}),I.a.createElement("div",{className:"CommentList"},k))):I.a.createElement("div",{className:"Comments"},I.a.createElement(K.a,{isConversation:!0,onNavBack:s}),I.a.createElement("div",{className:"CommentList"},k),w&&(h?I.a.createElement(z.a,{id:b,type:"conversation",className:"Comments-footer",replyTo:w,commentNeedsReview:m,onSubmit:this.addComment}):I.a.createElement("div",{className:"Comments-disabledText"},v)))}}]),t}(P.Component),b.propTypes={commentId:O.a.number.isRequired,type:O.a.string,parent:O.a.object.isRequired,commentNeedsReview:O.a.bool},b.contextTypes={currentUser:O.a.object,authRequired:O.a.func.isRequired},g),ee=Object(S.connect)(m)(X),te=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},ne=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),oe=(E=C=function(e){function t(e){d(this,t);var n=f(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));w.call(n);var o=e.parent,a=e.dispatch;return n.feature=function(e,t){return a(Object(N.i)(e,o.id,o.type,t))},n.delete=function(e){return a(Object(N.d)(e,o.type,o.id))},n.showConversation=function(e){return n.setState({openedCommentId:e})},n.showComments=function(){return n.setState({openedCommentId:null})},n}return h(t,e),ne(t,[{key:"componentDidMount",value:function(){var e=this.props.onMount;e&&e(this.domNode)}},{key:"render",value:function(){var e=this,t=this.props,n=t.parent,o=t.commentPattern,a=t.type,r=t.parent;r=void 0===r?{}:r;var i=r.commentPermission,s=r.relationship,c=void 0===s?{}:s,l=r.author,u=void 0===l?{}:l,m=t.needLoadCommentPermission,d=p(t,["parent","commentPattern","type","parent","needLoadCommentPermission"]),f=this.context.currentUser,h=void 0===c.isAuthor?f&&u.urlToken&&f.urlToken===u.urlToken:c.isAuthor,v="censor"===i&&!h,y="answer"===a||"article"===a,b=this.state,g=b.openedCommentId,C=b.status,E=b.order,w={commentNeedsReview:v,parent:n,type:a,canOperateItem:y,onShowConversation:this.showConversation,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve};return I.a.createElement("div",{className:"Comments-container",ref:function(t){return e.domNode=t}},I.a.createElement(Y,te({},d,w,{commentPattern:o,className:T()({"Comments--hidden":g&&"bottom"!==o}),order:E,status:C,onStatusChange:this.handleStatusChange,onOrderChange:this.handleOrderChange,needLoadCommentPermission:m,isAuthor:h})),g&&I.a.createElement(ee,te({},d,w,{commentPattern:o,commentId:g,onNavBack:this.showComments})))}}]),t}(P.Component),C.propTypes={type:O.a.string.isRequired,parent:O.a.object.isRequired,onOrderChange:O.a.func,onItemLike:O.a.func,isAuthor:O.a.bool,onMount:O.a.func},C.defaultProps={type:"answer"},C.contextTypes={currentUser:O.a.object,authRequired:O.a.func.isRequired},w=function(){var e=this;this.state={openedCommentId:null,status:"open",order:"normal"},this.like=function(t,n){var o=e.props,a=o.onItemLike,r=o.dispatch;a&&a(t,n),r(Object(N.j)(t))},this.collapse=function(t){var n=e.props,o=n.dispatch,a=n.parent;o(Object(N.g)(t,a.type,a.id))},this.dislike=function(t){return e.props.dispatch(Object(N.h)(t))},this.approve=function(t){var n=e.props,o=n.dispatch,a=n.parent,r=n.type;o(Object(N.b)(t,a.type||r,a.id))},this.handleStatusChange=function(t){e.setState({status:t})},this.handleOrderChange=function(t,n){e.props.onOrderChange&&e.props.onOrderChange(t,n),e.setState({order:t})}},E);t.default=Object(S.connect)()(oe)},1424:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function p(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var v,y,b,g,C,E,w,k=n(1),O=n.n(k),P=n(0),I=n.n(P),S=n(3),_=(n(80),n(33)),T=n(5),N=n(15),j=n(51),R=n(403),x=function(e,t,n){return n&&void 0!==t&&(e||!t)},A=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),L=(y=v=function(e){function t(){o(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.state={isPublic:!0,title:"",description:""},e.handleSubmit=e.handleSubmit.bind(e),e}return r(t,e),A(t,[{key:"handleSubmit",value:function(e){e.preventDefault();var t=this.state,n=t.isPublic,o=t.title,a=t.description;if(o){var r=this.props,i=r.onSubmit,s=r.onBack,c=r.authRequired,l=r.isActive,u={title:o,description:a,isPublic:n};x(n,l,c)?c(i)(u):(i(u),s())}}},{key:"render",value:function(){var e=this,t=this.state,n=t.title,o=t.description,a=t.isPublic,r=this.props.onBack,i=!n;return I.a.createElement("form",{className:"Favlists-content",onSubmit:this.handleSubmit},I.a.createElement("div",{className:"Favlists-addItems"},I.a.createElement("div",{className:"Favlists-addItem"},I.a.createElement(j.a,{className:"Favlists-titleInput",placeholder:"收藏标题",onChange:function(t){var n=t.target.value;e.setState({title:n})}}),I.a.createElement("div",{className:"Favlists-inputTips"},I.a.createElement(R.a,{name:"收藏标题",current:n?n.length:0,max:20}))),I.a.createElement("div",{className:"Favlists-addItem"},I.a.createElement(j.a,{multiline:!0,className:"Favlists-descritionInput",placeholder:"收藏描述（可选）",onChange:function(t){var n=t.target.value;e.setState({description:n})},rows:5}),I.a.createElement("div",{className:"Favlists-inputTips"},I.a.createElement(R.a,{name:"收藏描述",current:o?o.length:0,max:60}))),I.a.createElement("div",{className:"Favlists-addItem"},I.a.createElement("label",{className:"Favlists-privacyOption"},I.a.createElement("input",{className:"Favlists-privacyOptionRadio",name:"isPublic",type:"radio",value:"true",checked:a,onChange:function(){return e.setState({isPublic:!0})}}),I.a.createElement("span",null,"公开"),I.a.createElement("span",{className:"Favlists-privacyOptionTips"},"有其他人关注此收藏夹时不可设置为私密")),I.a.createElement("label",{className:"Favlists-privacyOption"},I.a.createElement("input",{className:"Favlists-privacyOptionRadio",name:"isPublic",type:"radio",value:"false",checked:!a,onChange:function(){return e.setState({isPublic:!1})}}),I.a.createElement("span",null,"私密"),I.a.createElement("span",{className:"Favlists-privacyOptionTips"},"只有你自己可以查看这个收藏夹")))),I.a.createElement(_.a,{direction:"horizontal",className:""},r&&I.a.createElement(S.c,{onClick:r},"返回"),I.a.createElement(S.c,{color:"blue",preset:"primary",type:"submit",disabled:i},"确认创建")))}}]),t}(P.Component),v.propTypes={onSubmit:O.a.func.isRequired,onBack:O.a.func,authRequired:O.a.func},y),D=L,M=n(73),F=n(404),U=n(7),B=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},V=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),q=function(e){function t(){var e,n,o,a;i(this,t);for(var r=arguments.length,c=Array(r),l=0;l<r;l++)c[l]=arguments[l];return n=o=s(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(c))),o.handleChange=function(){var e=o.props;(0,e.onChange)(e.id,o.props.checked)},a=n,s(o,a)}return c(t,e),V(t,[{key:"componentDidMount",value:function(){var e=this.props,t=e.zaEnabled,n=e.id;t&&T.a.setModule(this,{module:"CollectionItem"},{card:{card_type:"Content",content:{type:"Collection",token:String(n)}}})}},{key:"render",value:function(){var e=this.props,t=e.answerCount,n=e.title,o=e.isPublic,a=e.checked,r=void 0!==a&&a,i=r?{preset:"primary",color:"grey",children:"已收藏"}:{color:"blue",children:"收藏"};return I.a.createElement("div",{className:"Favlists-item"},I.a.createElement("div",{className:"Favlists-itemInner"},I.a.createElement("div",{className:"Favlists-itemName"},I.a.createElement("span",{className:"Favlists-itemNameText"},n),!1===o&&I.a.createElement("span",{className:"Favlists-itemIcon"},I.a.createElement(U.W,{size:16}))),I.a.createElement("div",{className:"Favlists-itemContent"},t," 条内容")),I.a.createElement(S.c,B({},i,{className:"Favlists-updateButton",onClick:this.handleChange})))}}]),t}(P.Component),z=q,W=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},G=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),K=(g=b=function(e){function t(){var e,n,o,a;l(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=u(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.items={},o.handleFavlistItemChange=function(e,t){T.a.trackEvent(o.items[e],{action:t?"UnCollect":"Collect",element:"Button",is_intent:!1}),o.props.onUpdate(e,t)},a=n,u(o,a)}return m(t,e),G(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.relations,o=t.items,a=t.isFetching,r=t.isDrained,i=t.onAdd,s=t.onLoad;return I.a.createElement("div",{className:"Favlists-content"},I.a.createElement(M.b,{isLocal:!0,isLoading:a,isDrained:r,onLoad:s,placeholder:I.a.createElement(F.a,{title:!0}),getContainer:function(e){return e},className:"Favlists-items"},o.map(function(t){return I.a.createElement(z,W({key:t.id,onChange:e.handleFavlistItemChange,checked:n[t.id]},t,{ref:function(n){e.items[t.id]=n}}))})),!o.length&&a||I.a.createElement("div",{className:"Favlists-actions"},I.a.createElement(S.c,{className:"Favlists-addButton",onClick:i,preset:"primary",color:"blue"},"创建收藏夹")))}}]),t}(P.Component),b.propTypes={isFecthing:O.a.bool,relations:O.a.object,onUpdate:O.a.func.isRequired,onAdd:O.a.func.isRequired,onLoad:O.a.func.isRequired,items:O.a.array.isRequired,isDrained:O.a.bool,authRequired:O.a.func},g),H=K,$=n(1087),J=n(1088),Y=(n(1139),n(1140),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),Z=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Q={list:{title:"添加收藏",tips:function(e){return e?"请选择你想添加的收藏夹":"你可以创建多个收藏夹，将答案分类收藏"}},add:{title:"创建新收藏夹"}},X=(E=C=function(e){function t(){var e,n,o,a;d(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=f(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),w.call(o),a=n,f(o,a)}return h(t,e),Z(t,[{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.shown,o=t.items,a=t.id,r=t.type,i=t.onFetchRelations,s=e.items,c=e.relations;if(i&&(s.length!==o.length&&e.shown||s.length&&!n&&e.shown)){var l=(c?s.filter(function(e){return!{}.hasOwnProperty.call(c,e.id)}):s).map(function(e){return e.id});l.length&&i(a,r,l)}s.length>o.length&&this.setState({status:"list"})}},{key:"componentDidUpdate",value:function(e){var t=this.props,n=t.id,o=t.type,a=t.shown,r=t.zaEnabled;a&&!e.shown&&this.container&&r&&T.a.setModule(this.container,{module:"CollectionDialogue"},{card:{card_type:"Content",content:{type:Object(J.a)(o),token:String(n)}}})}},{key:"render",value:function(){var e=this,t=this.state.status,n=Q[t],o=n.title,a=n.tips,r=this.props,i=r.shown,s=r.defaultStatus,c=r.relations,l=r.onFavlistAdd,u=r.onLoad,m=r.isFetching,d=r.isDrained,f=r.items,h=r.zaEnabled,v=r.authRequired,y=r.isUserActive,b=p(r,["shown","defaultStatus","relations","onFavlistAdd","onLoad","isFetching","isDrained","items","zaEnabled","authRequired","isUserActive"]),g=!(d&&!f.length),C=Object($.a)(b,Object.keys(N.b.propTypes)),E=C.selectedProps,w=void 0;return w="list"===t?g?I.a.createElement(H,{ref:function(t){e.container=t},items:f,isFetching:m,isDrained:d,relations:c,onAdd:this.handleAdd,onUpdate:this.handleUpdate,onLoad:u,zaEnabled:h}):I.a.createElement(_.a,null,I.a.createElement(S.c,{preset:"primary",color:"blue",onClick:this.handleAdd},"创建收藏夹"),I.a.createElement(S.c,{onClick:this.handleCloseModal},"取消")):I.a.createElement(D,{onSubmit:l,isActive:y,onBack:"add"===s?this.handleCloseModal:this.handleBack,authRequired:v}),I.a.createElement(N.b,Y({},E,{onClose:this.handleCloseModal,title:o,subtitle:a&&a(g),buttonGroupOnly:!g,className:"FavlistsModal",size:"large"}),i&&w)}}]),t}(P.Component),C.propTypes={id:O.a.oneOfType([O.a.string,O.a.number]),type:O.a.oneOf(["answer","article","pin"]),relations:O.a.object,onUpdateFav:O.a.func.isRequired,onFavlistAdd:O.a.func.isRequired,onFetchRelations:O.a.func,onClose:O.a.func.isRequired,shown:O.a.bool,zaEnabled:O.a.bool,authRequired:O.a.func,isUserActive:O.a.number},C.defaultProps={defaultStatus:"list",relations:{},authRequired:function(e){return e}},w=function(){var e=this;this.state={status:this.props.defaultStatus},this.handleCloseModal=function(){e.props.onClose&&e.props.onClose(),e.setState({status:"list"})},this.handleUpdate=function(t,n){var o=e.props,a=o.onUpdateFav,r=o.id,i=o.type,s=o.items,c=o.authRequired,l=o.isUserActive,u=s.find(function(e){return e.id===t})||{},m=[t,r,i,u.isPublic];return!n&&x(u.isPublic,l,c)?c(a).apply(void 0,m):a.apply(void 0,m)},this.handleAdd=function(){return e.setState({status:"add"})},this.handleBack=function(){return e.setState({status:"list"})}},E),ee=X;n.d(t,"FavlistsModal",function(){return ee})},1426:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function c(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function p(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function h(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function C(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function E(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function w(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function k(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function O(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function I(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var T,N,j,R,x,A,L,D,M,F,U,B,V=n(1),q=n.n(V),z=n(0),W=n.n(z),G=n(5),K=n(25),H=n.n(K),$=n(15),J=[{id:0,text:"举报",childIds:[1,2,3,4,5,21,7,8,9]},{id:1,text:"低质问题",types:["question"],childIds:[23,33,34,15,35,27,22]},{id:2,text:"垃圾广告信息",reason:"spam",copywriter:{title:"举报说明",placeholder:"举报详细说明（选填）",isRequired:!1},disabled:!0},{id:3,text:"不友善行为",types:["answer","comment","article","pin","book_review","favlist"],childIds:[40,41]},{id:4,text:"有害信息",childIds:[19,30,39,26,18,28]},{id:5,text:"涉嫌侵权",childIds:[20,29,12],types:["question","answer","comment","article","pin","book_review"],reason:"infringement",disabled:!0},{id:6,types:[]},{id:7,text:"其他",reason:"old",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:8,reason:"direction",shouldShow:function(e){return e.isColumnArticle}},{id:9,reason:"tipjar",shouldShow:function(e){return e.isTipjarEnabled}},{id:10,reason:"mention"},{id:11,reason:"privacy",disabled:!0},{id:12,reason:"enterprise",disabled:!0},{id:13,reason:"copy",copywriter:{title:"原文链接或出处",placeholder:"填写原文链接或描述内容出处（必填）"},disabled:!0},{id:14,reason:"defamation",disabled:!0},{id:15,reason:"abuse"},{id:16,reason:"intention"},{id:17,reason:"spam"},{id:18,reason:"illegality",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:19,reason:"politics"},{id:20,reason:"repost",copywriter:{title:"举报说明",placeholder:"原文链接或补充说明（必填）"},types:["answer","article","pin","book_review"],disabled:!0},{id:21,reason:"temptation",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0,types:["answer","comment","article"]},{id:22,reason:"personal"},{id:23,reason:"ambiguity"},{id:24,reason:"worthless"},{id:25,reason:"rumour"},{id:26,reason:"suicide",types:["question","answer","article","pin","book_review","comment"]},{id:27,reason:"medicine"},{id:28,reason:"superstition"},{id:29,reason:"oneself",disabled:!0},{id:30,reason:"porn"},{id:31,reason:"pirate"},{id:32,reason:"invalid"},{id:33,reason:"subjective"},{id:34,reason:"rumour"},{id:35,reason:"provoke"},{id:36,reason:"edit"},{id:37,reason:"harassment"},{id:38,reason:"hatred"},{id:39,reason:"untruth",types:["answer","comment","article","pin","book_review"],copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:40,reason:"abuse",text:"骚扰、辱骂、歧视等"},{id:41,reason:"unfriendly",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0}],Y=[{id:0,text:"举报",childIds:[1,2,3,4]},{id:1,text:"垃圾广告信息",reason:"spam"},{id:2,text:"不友善行为",reason:"unkind"},{id:3,text:"有害信息",reason:"imitation"},{id:4,text:"其他",reason:"old",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0}],Z=[{id:0,text:"举报",childIds:[1,2,3]},{id:1,reason:"abuse"},{id:2,reason:"harassment"},{id:3,reason:"spam"}],Q=[{id:0,text:"举报",childIds:[1,4,6,7]},{id:1,text:"冒充我或他人",childIds:[8,9],reason:"fake",disabled:!0},{id:2,reason:"abuse",text:"发过辱骂我或他人的内容"},{id:3,reason:"illegality",text:"发过违反法律法规的内容"},{id:4,reason:"spam",text:"垃圾广告帐号"},{id:5,reason:"politics",text:"发过政治敏感内容"},{id:6,reason:"profile",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:7,reason:"old",text:"其他",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},disabled:!0},{id:8,text:"冒充我",reason:"oneself",disabled:!0},{id:9,reason:"impersonate",copywriter:{title:"举报说明",placeholder:"举报详细说明（必填）"},text:"冒充他人",disabled:!0}],X=n(2),ee=n.n(X),te=n(3),ne=n(33),oe=n(37),ae=n(388),re=n(7),ie=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),se=(N=T=function(e){function t(){o(this,t);var e=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.handleClick=e.handleClick.bind(e),e}return r(t,e),ie(t,[{key:"handleClick",value:function(){var e=this.props,t=e.id,n=e.reason,o=e.disabled,a=e.onSubMenuEnter,r=e.onItemSelect;n&&!o?r(t):a(t)}},{key:"render",value:function(){var e=this.props,t=e.reason,n=e.text,o=e.disabled,a=e.isSelected,r=e.id,i=n||ae.b[t];return Boolean(t&&!o)?W.a.createElement("label",{className:"ReportMenu-item",htmlFor:t},W.a.createElement("div",{className:"ReportMenu-itemValue needsclick"},i),W.a.createElement("input",{className:"ReportMenu-itemCheck",type:"radio",name:"report",value:r,id:t,checked:a,onChange:this.handleClick}),W.a.createElement(re.m,{size:18,className:"ReportMenu-itemCheckIcon",name:"checkRound"})):W.a.createElement("button",{className:"ReportMenu-item",onClick:this.handleClick},W.a.createElement("span",{className:"ReportMenu-itemValue"},i),W.a.createElement(re.e,{size:18}))}}]),t}(z.Component),T.propTypes={id:q.a.number.isRequired,reason:q.a.string,text:q.a.string,disabled:q.a.bool,isSelected:q.a.bool,onSubMenuEnter:q.a.func.isRequired,onItemSelect:q.a.func.isRequired},N),ce=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),le=(R=j=function(e){function t(){return i(this,t),s(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return c(t,e),ce(t,[{key:"render",value:function(){var e=this.props,t=e.reason,n=e.isMobile;switch(t){case"oneself":return W.a.createElement("div",{className:"ReportMenu-inner"},W.a.createElement("div",{className:"ReportMenu-paragraph"},"当您发现知乎上有关于您个人的侵权内容时，您可通过此渠道向知乎提交举报诉求。"),W.a.createElement("div",{className:"ReportMenu-paragraph"},"根据",W.a.createElement("a",{className:"ReportMenu-link",href:"https://www.zhihu.com/terms#sec-report",target:"_blank",rel:"noopener noreferrer"},"知乎侵权举报规范"),"，您需要向我们提交您的个人信息，其中包括身份证明。如您确认已准备齐全，",n?W.a.createElement("span",null,W.a.createElement("strong",null,"请到桌面版网页进行诉求提交。")):W.a.createElement("span",null,"可点击下方按钮进入诉求提交页。")));case"privacy":return W.a.createElement("div",{className:"ReportMenu-inner"},W.a.createElement("div",{className:"ReportMenu-paragraph"},"您好，当您发现知乎上有泄漏您隐私的内容时，您可向知乎进行举报。 请您把以下内容通过邮件发送到 ",W.a.createElement("a",{className:"ReportMenu-link",href:"mailto:i@zhihu.com"},"i@zhihu.com")," 邮箱，我们会尽快处理。"),W.a.createElement("ul",{className:"ReportMenu-paragraph"},W.a.createElement("li",null,"1. 您认为哪些内容泄露了您的隐私？（请在邮件中列出您举报的内容、链接地址，并给出简短的说明）"),W.a.createElement("li",null,"2. 您是谁？（身份证明材料，可以是身份证或护照等证件）")),W.a.createElement("div",{className:"ReportMenu-paragraph ReportMenu-paragraph--light"},"邮件格式请参考",W.a.createElement("a",{className:"ReportMenu-link--light",href:"https://www.zhihu.com/terms#sec-report",target:"_blank",rel:"noopener noreferrer"},"这里"),"；"));case"enterprise":return W.a.createElement("div",{className:"ReportMenu-inner"},W.a.createElement("div",{className:"ReportMenu-paragraph"},"当您发现知乎上有关于您企业的侵权等内容时，知乎建议您先尝试与作者沟通解决问题。 如果您无法联系到作者，您也可通过此渠道向知乎提出诉求。"),W.a.createElement("div",{className:"ReportMenu-paragraph"},"根据",W.a.createElement("a",{className:"ReportMenu-link",href:"https://www.zhihu.com/terms#sec-report",target:"_blank",rel:"noopener noreferrer"},"知乎侵权举报规范"),"，您需要向我们提交您的个人信息，其中包括身份证明。如您确认已准备齐全，",n?W.a.createElement("span",null,W.a.createElement("strong",null,"请到桌面版网页进行诉求提交。")):W.a.createElement("span",null,"可点击下方按钮进入诉求提交页。")));case"defamation":return W.a.createElement("div",{className:"ReportMenu-inner"},W.a.createElement("div",{className:"ReportMenu-paragraph"},"您好，当您发现知乎上有诽谤您的内容时，您可以向知乎进行举报。 请您把以下内容通过邮件发送到",W.a.createElement("a",{className:"ReportMenu-link",href:"mailto:i@zhihu.com"}," ","i@zhihu.com"," "),"邮箱，我们会尽快处理。"),W.a.createElement("ul",{className:"ReportMenu-paragraph"},W.a.createElement("li",null,"1. 您举报的内容以及侵犯了您什么权益？（请在邮件中列出您举报的内容、链接地址，并给出简短的说明）"),W.a.createElement("li",null,"2. 您是谁？（身份证明材料，可以是身份证或护照等证件）")),W.a.createElement("div",{className:"ReportMenu-paragraph ReportMenu-paragraph--light"},"邮件格式请参考 ",W.a.createElement("a",{className:"ReportMenu-link--light",href:"https://www.zhihu.com/terms#sec-report",target:"_blank",rel:"noopener noreferrer"},"这里")," ；"));default:return null}}}]),t}(z.Component),j.propTypes={reason:q.a.string.isRequired},R),ue=n(51),me=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),pe=(A=x=function(e){function t(){return l(this,t),u(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return m(t,e),me(t,[{key:"render",value:function(){var e=this.props,t=e.copywriter.placeholder,n=e.onDetailInput,o=e.errorText,a=e.checkCustomReasonContent;return W.a.createElement("div",{className:"ReportMenu-inner"},W.a.createElement(ue.a,{multiline:!0,grey:!0,rows:5,className:"ReportMenu-textarea",placeholder:t,onChange:function(e){return n(e.target.value)},onBlur:a}),W.a.createElement("div",{className:"ReportMenu-errorText"},o))}}]),t}(z.Component),x.propTypes={onDetailInput:q.a.func.isRequired,copywriter:q.a.object,errorText:q.a.string},A),de=(n(1406),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),fe=function(e){function t(){return p(this,t),d(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return f(t,e),de(t,[{key:"render",value:function(){var e=this.props,t=e.checked,n=e.onChange,o=e.name,a=e.text,r=e.desc,i=o||a;return W.a.createElement("div",null,W.a.createElement("label",{className:"ReportOption-check",htmlFor:i},W.a.createElement("input",{type:"checkbox",name:i,checked:t,onChange:n}),W.a.createElement("span",null,"同时",a)),r&&W.a.createElement("div",{className:"ReportOption-desc"},r))}}]),t}(z.Component),he=fe,ve=function(e){var t=/[\u4e00-\u9fa5a-zA-Z0-9]/;return e.length>150?{isLegal:!1,errorReason:ae.a.contentTooLong}:t.test(e)?{isLegal:!0,errorReason:""}:{isLegal:!1,errorReason:ae.a.contentIllegal}},ye=(n(1407),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),be=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),ge=(D=L=function(e){function t(){var e,n,o,a;v(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=y(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={isBlock:!1,blockChecked:null,commentChecked:null,activeId:0,parentId:null,selectedId:null,errorText:"",isMobile:!1},o.menuItems={},o.handleItemSelect=function(e){var t=o.selectedId===e?null:e;o.setState({selectedId:t});var n=o.props,a=n.zaEnabled,r=n.type;t&&a&&G.a.trackEvent(o.menuItems[t],{action:"Select",element:"Menu"},{report:{id:e,type:r}})},o.handleSubMenuEnter=function(e){o.setState(function(t){var n=t.activeId;return{activeId:e,parentId:n,selectedId:null}});var t=o.props,n=t.zaEnabled,a=t.type;n&&G.a.trackEvent(o.menuItems[e],{action:"Expand",element:"Menu"},{report:{id:e,type:a}})},o.getCommentChecked=function(){var e=o.state,t=e.commentChecked,n=e.parentId,a=e.activeId;return"boolean"==typeof t?t:[2,3].includes(n||a)},o.handleDetailInput=function(e){o.setState({customReason:e,errorText:""})},o.handleBackClick=function(){var e=o.props.nodes,t=o.state.parentId,n=Object.keys(e).find(function(n){var o=e[n].childIds;return o&&o.includes(t)});o.setState({activeId:t,parentId:n&&Number(n),selectedId:null,hasWarning:!1,customReason:"",errorText:""});var a=o.props,r=a.zaEnabled,i=a.type;r&&G.a.trackEvent(o,{action:"Back",element:"Button"},{report:{id:o.state.activeId,type:i}})},o.handleSubmitAppeal=function(){var e="",t=o.state.activeId,n=o.props,a=n.type,r=n.urlToken,i=n.nodes;"enterprise"===i[t].reason||13===t?e="org":"oneself"!==i[t].reason&&37!==t||(e="people"),window.open("//www.zhihu.com/account/complaints/"+e+"/"+a+"/"+r)},o.handleSubmit=function(){var e=o.state,t=e.selectedId,n=e.customReason,a=e.activeId,r=e.blockChecked;if(o.isSubmitEnabled()&&o.checkCustomReasonContent()){var i=o.props,s=i.nodes,c=i.onBlockUser,l=i.talkerToken,u=i.onSubmit,m=i.onDeleteComment,p=s[t||a],d=p.reason,f=p.id,h=u({reason:d,customReason:n});h&&h.then&&h.then(function(){r&&c(l),o.getCommentChecked()&&m()});var v=o.props,y=v.zaEnabled,b=v.type;y&&G.a.trackEvent(o,{action:"Report",element:"Button"},{report:{id:f,type:b}})}},o.checkCustomReasonContent=function(){var e=o.state,t=e.activeId,n=e.customReason,a=o.props.nodes,r=a[t].copywriter;if((14===t||24===t||Boolean(r))&&n){var i=ve(n),s=i.isLegal,c=i.errorReason;if(!s)return o.setState({errorText:c}),!1}return!0},a=n,y(o,a)}return b(t,e),be(t,[{key:"componentDidMount",value:function(){var e=Object(oe.a)(navigator.userAgent);this.setState({isMobile:e.Mobile})}},{key:"componentWillUpdate",value:function(e,t){var n=this.state.activeId,o=t.activeId,a=this.props,r=a.nodes,i=a.onContentChange;if(o!==n){var s=r[o],c=s.reason,l=s.text,u=s.childIds,m=s.copywriter;i(l||ae.b[c],m&&m.title||(u?void 0:""))}}},{key:"isSubmitEnabled",value:function(){var e=this.state,t=e.selectedId,n=e.activeId,o=e.customReason,a=this.props.nodes;return t||(Boolean(a[n].copywriter)||14===n||24===n)&&(!1===a[n].copywriter.isRequired||o)}},{key:"render",value:function(){var e=this,t=this.props,n=t.nodes,o=h(t,["nodes"]),a=this.state,r=a.activeId,i=a.parentId,s=a.selectedId,c=a.errorText,l=a.isMobile,u=n[r],m=u.reason,p=u.childIds,d=u.copywriter,f=Boolean(p),v=14===r||24===r||Boolean(d),y=f&&W.a.createElement("div",{className:"ReportMenu-inner ReportMenu-options"},p.map(function(e){return n[e]}).filter(function(e){return e&&(!e.shouldShow||e.shouldShow(o))}).map(function(t){return W.a.createElement(se,ye({ref:function(n){e.menuItems[t.id]=n},key:t.id},t,{isSelected:s===t.id,onSubMenuEnter:e.handleSubMenuEnter,onItemSelect:e.handleItemSelect}))})," ")||v&&W.a.createElement(pe,{onDetailInput:this.handleDetailInput,copywriter:d,errorText:c,checkCustomReasonContent:this.checkCustomReasonContent})||W.a.createElement(le,{isMobile:l,reason:m}),b=f&&o.talkerToken&&W.a.createElement(he,{checked:this.state.blockChecked,text:"将此人屏蔽",onChange:function(t){return e.setState({blockChecked:t.target.checked})}}),g=i||r,C=o.onDeleteComment&&[2,3].includes(g)&&W.a.createElement(he,{checked:this.getCommentChecked(),desc:Boolean(g)&&"社区鼓励举报"+n[g].text+"，同时可以直接删除该评论，删除操作并不影响对违规内容和违规用户的处理。",onChange:function(t){return e.setState({commentChecked:t.target.checked})},text:"删除该评论"});return W.a.createElement("div",{className:ee()("ReportMenu",{"ReportMenu-mobile":l})},y,(b||C)&&W.a.createElement("div",null,b,C),W.a.createElement(ne.a,{direction:"horizontal"},"number"==typeof i&&W.a.createElement(te.c,{onClick:this.handleBackClick}," 返回 "),f||v?W.a.createElement(te.c,{className:"ReportMenu-button",disabled:!this.isSubmitEnabled(),onClick:this.handleSubmit,color:"blue",preset:"primary"},"举报"):!l&&W.a.createElement(te.c,{onClick:this.handleSubmitAppeal,preset:"primary",color:"blue"},"进入诉求提交页面")))}}]),t}(z.Component),L.propTypes={nodes:q.a.object.isRequired,onContentChange:q.a.func.isRequired,onSubmit:q.a.func.isRequired,onDeleteComment:q.a.func,talkerToken:q.a.string,isColumnArticle:q.a.bool,isTipjarEnabled:q.a.bool},D),Ce=ge,Ee=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},we=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),ke=(F=M=function(e){function t(){var e,n,o,a;E(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=w(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.filterNodes=function(e,t,n){var o=e.filter(function(e){return-1!=["infringement","repost","oneself","enterprise","fake"].indexOf(e.reason)||0===e.id||("question"!==t||-1==["closed","suggested","evaluated","locked"].indexOf(n)||0===e.id)&&("member"!==t||-1==["ban","hang"].indexOf(n)||"profile"===e.reason)});return 1===o.length&&0===o[0].id&&(o=[]),o},a=n,w(o,a)}return k(t,e),we(t,[{key:"render",value:function(){var e=this.props,t=e.type,n=e.status,o=C(e,["type","status"]),a=void 0;return a="message"===t?Z:"member"===t?Q:"favlist"===t?Y:J.filter(function(e){return!e.types||e.types.includes(t)}),a=this.filterNodes(a,t,n),W.a.createElement(Ce,Ee({nodes:a.reduce(function(e,t){return Ee({},e,g({},t.id,t))},{})},o,{type:t}))}}]),t}(z.Component),M.propTypes={type:q.a.string.isRequired},F),Oe=n(1087),Pe=n(1088),Ie=n(54),Se=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},_e=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Te="请选择举报理由",Ne="举报",je=function(e){return e&&e.isBlocking},Re=(B=U=function(e){function t(){var e,n,o,a;I(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=S(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={title:void 0!==o.props.title?o.props.title:Ne,subtitle:void 0!==o.props.subtitle?o.props.subtitle:Te},o.handleSubmit=function(e){var t=e.reason,n=e.customReason,a=o.props,r=a.onClose,i=a.urlToken,s=a.type,c=o.props.doReport(i,s,t,n);if(c&&c.then)return c.then(r);r()},o.handleContentChange=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Te;o.setState({title:e,subtitle:t})},o.handleBlockUser=function(e){o.props.updateUserBlocking&&o.props.updateUserBlocking(e,!0)},o.handleClose=function(){o.props.zaEnabled&&G.a.trackEvent(o.container,{action:"Ok"},{button:{text:"知道了"}}),o.props.onClose()},a=n,S(o,a)}return _(t,e),_e(t,[{key:"componentWillMount",value:function(){var e=this.props,t=e.talker,n=e.talkerId;n&&(je(t)?t.isBlocking||this.setState({blockVisabled:!0}):this.props.loadProfile(n))}},{key:"componentWillReceiveProps",value:function(e){var t=this.props.talker,n=e.talker;je(t)||!je(n)||n.isBlocking||this.setState({blockVisabled:!0})}},{key:"componentDidUpdate",value:function(e){if(!e.shown&&this.props.shown){var t=this.props,n=t.type,o=t.id;G.a.setModule(this.container,{module:"ReportDialog"},{card:{card_type:"Content",content:P({type:Object(Pe.a)(n)},"comment"===n?"id":"token",String(o))}})}}},{key:"render",value:function(){var e=this,t=H()(this.props,["onClose"]),n=t.shown,o=O(t,["shown"]),a=this.state,r=a.title,i=a.subtitle,s=a.blockVisabled,c=Object(Oe.a)(o,Object.keys($.b.propTypes)),l=c.selectedProps,u=c.dropedProps;return W.a.createElement($.b,Se({title:r,subtitle:i,onClose:this.handleClose,className:"ReportModal"},l),n&&W.a.createElement(ke,Se({ref:function(t){e.container=t},onSubmit:this.handleSubmit,blockVisabled:s,onClose:this.handleClose,onContentChange:this.handleContentChange},u)))}}]),t}(z.Component),U.propTypes={onClose:q.a.func.isRequired,type:q.a.oneOf(Ie.a).isRequired,urlToken:q.a.oneOfType([q.a.string,q.a.number]).isRequired,shown:q.a.bool.isRequired,talkerId:q.a.string,isColumnArticle:q.a.bool,isTipjarEnabled:q.a.bool,loadProfile:q.a.func,updateUserBlocking:q.a.func,doReport:q.a.func.isRequired,zaEnabled:q.a.bool},U.defaultTypes={zaEnabled:!1},B);n.d(t,"ReportModal",function(){return Re})},1427:function(e,t,n){"use strict";function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(){return function(e){e({API:{types:Pe.GET_STICKERS,method:"GET",endpoint:"/stickers"}})}}function r(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.order,r=void 0===a?"normal":a,i=n.isPrevious,s=void 0!==i&&i,c=n.byComment,l=n.status,u=void 0===l?"open":l,m=n.commentPattern,p=n.current,d=n.patternLimit,f=void 0===d?20:d,h=n.byCommentLimit,v=arguments[3];return function(n,a){var i=a(),l=i.comments,d=l.pagination,y=Pe.GET;"reviewing"===u&&(d=l.reviewing,y=Pe.GET_REVIEWING),"collapsed"===u&&(d=l.collapsed,y=Pe.GET_COLLAPSED),"reverse"===r&&"open"===u&&(d=l.reverse,y=Pe.GET_REVERSE);var b=d[e+"_"+t]||{},g=b.next,C=b.previous,E=b.ids,w=void 0===E?[]:E;if(!b.isFetching){var k=w.length&&(s?C:g);c&&(k=!1);var O=0,P=be.a;return"bottom"!==m||v||(O=(p-1)*f,P=f,k=!1),n({parentId:t,isCommentV2:!0,parentType:e,isPrevious:s,API:Ee({types:y},k?{endpoint:k}:Ee({endpoint:(Oe[e]||e)+"s/"+t+"/"+("reviewing"===u||c||"reverse"===r||v?"comments":"root_comments")},{root:ke},{query:Ee({include:"data[*]."+we,order:r,limit:c?h:P},"open"===u&&c?{byComment:c}:{offset:O,status:u})})),schema:ye.a.COMMENT_ARRAY_V2,UPDATE:{failure:function(n){return n&&n.res&&403===n.res.status?o({},e+"s",o({},t,{adminClosedComment:!0})):{}}},NOTIFICATION:{key:ge.c,failure:function(e){return(!e||403!==e.code)&&ge.a}}})}}}function i(e){var t=e.parentType,n=e.parentId,a=e.content,r=e.replyTo,i=e.conversationId,s=e.rootCommentId,c=e.isConversation,l=e.replyType,u=e.isAnchorComments;return function(e,m){var p=r&&r.id||void 0,d=m().entities.comments,f=t+"s",h=(m().entities[f]||{})[n]||{},v=h.commentCount,y=Oe[t]||t,b="评论发布成功！";return"commercial"===h.questionType&&"censor"===h.commentPermission&&(b="评论已提交，由品牌筛选后公开"),e({parentType:t,isCommentV2:!0,parentId:n,id:i,rootCommentId:s,comments:d,isConversation:c,replyType:l,isAnchorComments:u,API:{types:Pe.ADD,endpoint:y+"s/"+n+"/comments",query:{include:we},method:"POST",body:Object(ve.decamelizeKeys)({content:a,replyToId:p})},schema:ye.a.COMMENT,UPDATE:{request:o({},f,o({},n,{commentCount:v+1})),failure:o({},f,o({},n,{commentCount:v}))},NOTIFICATION:{key:ge.c,success:b,failure:"评论发布失败。"},replyToId:p,replyTo:r})}}function s(e){return function(t,n){var a,r,i=n(),s=i.entities.comments,c=s[e]||s[e+"_featured"],l=c.voteCount,u=c.voting,m=c.disliked;return t({id:e,isCommentV2:!0,API:{types:Pe.UPDATE_LIKE,endpoint:"comments/"+e+"/actions/like",method:u?"DELETE":"POST",fetchOptions:{zsSignature:!0}},UPDATE:{request:{comments:(a={},o(a,e,{voteCount:l+(u?-1:1),voting:!u,disliked:!!u&&m}),o(a,e+"_featured",{voteCount:l+(u?-1:1),voting:!u,disliked:!!u&&m}),a)},success:function(t){var n;return{comments:(n={},o(n,e,t),o(n,e+"_featured",t),n)}},failure:{comments:(r={},o(r,e,c),o(r,e+"_featured",{voteCount:l,disliked:m}),r)}},NOTIFICATION:{key:ge.c,failure:ge.a}})}}function c(e){return function(t,n){var a,r,i=n(),s=i.entities.comments,c=s[e],l=c.voting,u=c.voteCount,m=c.disliked,p=!m;return t({id:e,isCommentV2:!0,API:{types:Pe.UPDATE_DISLIKE,endpoint:"comments/"+e+"/actions/dislike",method:m?"DELETE":"POST",fetchOptions:{zsSignature:!0}},UPDATE:{request:{comments:(a={},o(a,e,{disliked:p,voting:!!m&&l,voteCount:p&&l?u-1:u}),o(a,e+"_featured",{disliked:p,voting:!!m&&l,voteCount:p&&l?u-1:u}),a)},failure:{comments:(r={},o(r,e,c),o(r,e+"_featured",{disliked:m,voting:l,voteCount:u}),r)}},NOTIFICATION:{key:ge.c,failure:ge.a}})}}function l(e,t,n){return function(a,r){var i,s=t+"s",c=r(),l=c.entities,u=l[s][n]||{commentCount:0},m=l.comments[e],p=m.collapsed,d=m.reviewing;return a({id:e,isCommentV2:!0,collapsed:p,reviewing:d,parentType:t,parentId:n,API:{types:Pe.DELETE,endpoint:"comments/"+e,method:"delete"},UPDATE:{request:o({comments:(i={},o(i,e,{isDelete:!0}),o(i,e+"_featured",{isDelete:!0}),i)},s,Ee({},!d&&o({},n,{commentCount:u.commentCount-1}))),failure:o({comments:o({},e,{isDelete:!1})},s,o({},n,u))},NOTIFICATION:{key:ge.c,failure:ge.a}})}}function u(e){var t=e.id,n=e.isAnchorComments,o=e.isLoadRest;return function(e,a){var r=a(),i=r.comments.conversation,s=r.entities.comments,c=void 0;if(i[t]&&i[t].newIds.length){var l=i[t],u=l.newIds,m=l.next,p=l.isFetching;if(!u.length||p)return;c=m}else c=n?"comments/"+t+"/anchor_comments":"comments/"+t+"/child_comments";return e({id:t,isLoadRest:o,comments:s,isCommentV2:!0,API:{types:Pe.GET_CONVERSATION,endpoint:c,query:{include:"$[*].author,reply_to_author,content,vote_count"}},schema:ye.a.COMMENT_ARRAY_V2,NOTIFICATION:{key:ge.c,failure:ge.a}})}}function m(e){var t=e.nextUrl,n=e.commentId;return function(e,o){var a=o().comments.conversationMore,r=a[n]||{},i=r.isFetching,s=r.next,c=r.isDrained;if(!i&&!c)return e({id:n,isCommentV2:!0,API:{types:Pe.GET_CONVERSATION_MORE,endpoint:s||t},schema:ye.a.COMMENT_ARRAY,NOTIFICATION:{key:ge.c,failure:ge.a}})}}function p(e,t,n,a){return function(r,i){var s=i(),c=s.entities.comments,l=c[e],u=l.featured,m=l.collapsed;return r({id:e,isCommentV2:!0,parentId:t,parentType:n,lastFeaturedIndex:a,expect:!u,API:{types:Pe.UPDATE_FEATURED,endpoint:"comments/"+e+"/actions/feature",method:u?"delete":"post"},UPDATE:{request:{comments:o({},e,{featured:!u,collapsed:!!u&&m})},failure:{comments:o({},e,l)}},NOTIFICATION:{key:ge.c,failure:ge.a,endpoint:"comments/"+e+"/actions/feature",method:u?"delete":"post"}})}}function d(e,t,n){return function(a,r){var i=r(),s=i.entities,c=s.comments[e],l=c.collapsed,u=c.featured,m=!l;return a({id:e,isCommentV2:!0,expect:m,parentType:t,parentId:n,API:{types:Pe.UPDATE_COLLAPSED,endpoint:"comments/"+e+"/actions/collapse",method:m?"post":"delete"},UPDATE:{request:{comments:o({},e,{collapsed:m,featured:!m&&u})},failure:{comments:o({},e,c)}},NOTIFICATION:{key:ge.c,failure:ge.a}})}}function f(e,t,n){return function(a,r){var i=r(),s=i.entities,c=s.comments[e],l=t+"s",u=s[l][n]||{commentCount:0};return a({id:e,isCommentV2:!0,parentId:n,parentType:t,API:{types:Pe.APPROVE,endpoint:"comments/"+e+"/actions/approve",method:"PUT"},UPDATE:{request:o({comments:o({},e,{status:"open",isDelete:!0})},l,o({},n,{commentCount:u.commentCount+1})),failure:o({comments:o({},e,c)},l,o({},n,u))}})}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function y(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function b(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function C(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function E(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function w(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function k(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function O(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function P(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function I(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function T(e,t){switch(e){case"answer":return Object(Rt.c)(t);case"article":return Object(xt.b)(t);default:return null}}function N(e){var t=e.id,n=e.replyTo;if(e.isConversation)return{type:"conversation"};if(!n)return{type:"comment"};var o=n.featured,a=n.replyToAuthor,r=n.id;return t===r&&o&&!a?{type:"replyToFeatured"}:t===r&&o&&a?{type:"replyToSubFeatured"}:t!==r||a?t!==r&&a?{type:"replyToSubCommon"}:{type:"comment"}:{type:"replyToCommon"}}function j(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function R(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function A(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function L(e,t){var n=t.parent,o=t.parent,a=o.type,r=o.id,i=t.status,s=t.order,c=t.byComment,l=t.commentPattern,u=t.notificationId,m=e.entities,p=e.comments,d=e.comments,f=d.conversation,h=d.stickers,v=void 0===h?[]:h,y=a+"_"+r,b=p.parent,g=m.comments[c],C=p.pagination;"reviewing"===i&&(C=p.reviewing);var E="reverse"===s&&"open"===i;E&&(C=p.reverse);var w=[],k=p.collapsed[y]||{};k&&k.ids&&k.ids.length>0&&(w=k.ids.map(function(e){return m.comments[e]}));var O=C[y]||{isPrevDrained:!1,isFetching:!1,isDrained:!1,ids:[]},P=O.isFetching,I=O.isPrevDrained,S=O.isDrained,_=O.ids,T=O.newIds,N=void 0===T?[]:T,j=O.totals,R="bottom"!==l?_:N,x=R.map(function(e){return m.comments[e]}),A=xe()(R,function(e){return String(e).includes("_featured")}),L={voteUp:"赞了你的评论",debfult:""},D=je()(m,"notifications["+u+"].content.verb",L.default),M=je()(m,"notifications["+u+"].content.actors",[]).length||1;return{isFetching:P,isPrevDrained:I,isDrained:S,totals:j,collapsedInfo:k,collapsedComments:w,targetComment:g,conversation:f,entities:m,stickers:v,lastFeaturedIndex:A,byCommentLimit:D===L.voteUp&&1||M,comments:x,isReverseAndStatusOpen:E,parent:At({},n,b[y])}}function D(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function F(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function U(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function B(e,t){var n=t.commentId,o=t.isAnchorComments,a=e.entities.comments,r=e.comments,i=r.conversation,s=r.conversationMore,c=i[n]||{isFetching:!1,isDrained:!1,isPrevDrained:!1,ids:[]},l=c.isFetching,u=c.isDrained,m=c.isPrevDrained,p=c.ids,d=c.totals,f=c.topComments;f=void 0===f?{}:f;var h=f.paging,v=h||{},y=v.isEnd,b=s[n]||{isFetching:!1,isDrained:!1,ids:[]},g=b.isFetching,C=b.isDrained,E=b.ids,w=E.map(function(e){return a[e]}),k=p.map(function(e){return a[e]}),O=a[n+"_featured"]||a[n]||{},P=o?Ft()(E.length?[].concat(D(k.slice(0,4)),D(w),D(k.slice(4))):k,"id"):[O].concat(D(k)),I=h?[].concat(D(k.slice(0,3)),D(w)).length:-1;return{isFetching:l,isDrained:u,isPrevDrained:m,totals:d,comments:P,openComment:O,topCommentsPaging:h,isConversationMoreFetching:g,isConversationMoreDrained:y||C,offsetIndex:I}}function V(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function q(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function z(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function W(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var G,K,H,$,J,Y,Z,Q,X,ee,te,ne,oe,ae,re,ie,se,ce,le=n(0),ue=n.n(le),me=n(1),pe=n.n(me),de=n(4),fe=n(2),he=n.n(fe),ve=n(9),ye=n(20),be=n(26),ge=n(12),Ce=n(6),Ee=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},we="author,collapsed,reply_to_author,disliked,content,voting,vote_count,is_parent_author,is_author",ke="//www.zhihu.com/api/v4/",Oe={ebook:"book"},Pe=Ee({},Object(Ce.a)("comment",["GET","GET_COLLAPSED","GET_REVERSE","GET_REVIEWING","GET_CONVERSATION","UPDATE_LIKE","UPDATE_DISLIKE","UPDATE_FEATURED","UPDATE_COLLAPSED","APPROVE","DELETE","ADD","GET_MORE_REPLY_COMMENT","GET_CONVERSATION_MORE","GET_STICKERS"]),Object(Ce.b)("comment",["ORDER"])),Ie=n(1085),Se=n(52),_e=n(61),Te=n.n(_e),Ne=n(233),je=n.n(Ne),Re=n(1410),xe=n.n(Re),Ae=n(19),Le=n(73),De=n(1086),Me=n(29),Fe=n(3),Ue=n(223),Be=n(18),Ve=n(23),qe=n(5),ze=n(106),We=n.n(ze),Ge=n(31),Ke=n(21),He=n(78),$e=n(7),Je=n(15),Ye=(n(154),n(225)),Ze=n(237),Qe=n(107),Xe=n(1053),et=n(1078),tt=n(105),nt=(n(1411),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),ot=(G=Object(de.connect)(null,{uploadImage:tt.b}))(K=function(e){function t(e){h(this,t);var n=v(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.handleImageUploadError=function(e,t){var o=n.props.onImageUploadError;o&&o(e,t)},n.handleClickImageUpload=function(){var e=n.props.onClickImageUpload;e&&setTimeout(function(){e()})},n.handleImageUploaded=function(e,t){var o=e||{},a=o.src,r=o.rawWidth,i=o.rawHeight,s=o.watermark,c=o.originalSrc,l=o.watermarkSrc;a?n.props.onImageUploaded({url:a,width:r,height:i,watermark:s,originalSrc:c,watermarkSrc:l},t):n.handleImageUploadError({},t)},n.state={images:[],file:""},n.uploadManager=new Xe.b({uploadImage:function(e){return n.props.uploadImage(e,n.props.uploadType,n.props.sourceType).then(function(e){return e.payload}).then(function(e){return{url:e.src,originalSrc:e.originalSrc,watermarkSrc:e.watermarkSrc,watermark:e.watermark,rawWidth:e.dataRawwidth,rawHeight:e.dataRawheight,id:e.hash}}).catch(function(e){return e})}}),n}return y(t,e),nt(t,[{key:"render",value:function(){var e=this,t=this.props,n=t.file,o=t.className,a=this.props.images;return n||0!==a.length?ue.a.createElement("div",{className:he()("Comment-uploadImage-container",o)},ue.a.createElement("ul",null,a.map(function(t){if(t.url){var n=/\.gif$/.test(t.url),o="";return o=Object(Ge.a)(t.url,"xl"),n&&(o=o.replace(/\.gif$/,".jpg")),ue.a.createElement("li",{key:t.uid},ue.a.createElement("img",{src:o,alt:"图片"}),n&&ue.a.createElement("em",null,"GIF"))}return t.file?ue.a.createElement("li",{key:t.uid},ue.a.createElement(et.a,{uploadManager:e.uploadManager,onImageUploaded:function(n){e.handleImageUploaded(n,t.uid)},onImageUploadError:function(n){e.handleImageUploadError(n,t.uid)},data:{upload:{type:"file",value:t.file}}})):null}))):null}}]),t}(le.Component))||K,at=n(17),rt=(n(79),"zhihu::comment_local_key"),it=5,st={IMAGE:[".png",".jpeg",".gif",".jpg"]},ct=10,lt={IMAGE:1024*ct*1024},ut=1e3,mt=980,pt=function(){return""},dt=function(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})},ft=(n(1412),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),ht=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),vt=function(e,t){return Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}(["回复","",""],["回复","",""]),yt=(H=Object(de.connect)(function(e){return{edition:Object(at.d)(e),referer:Object(at.i)(e),shouldOia:Object(at.j)(e),stickers:e.comments.stickers||[]}},{showNotification:ge.g}),Object(Ve.withRouter)($=H((Y=J=function(e){function t(){var e,n,o,a;g(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=C(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={active:!1,disabled:!0,shown:!1,value:{toHTML:pt},images:[],uploadIsFetchingNum:0,sticker:[],stickerIconActive:!1,toggleInputStyle:!1,commentTextLength:0},o.handleSubmit=o.context.authRequired(function(){var e=o.props,t=e.replyTo,n=e.onSubmit,a=e.onCancel,r=e.rootCommentId,i=e.isConversation,s=o.state,c=s.images,l=s.sticker,u=o.input.toHTML();if(u||c.length||l.length){u&&o.saveLocalComment();var m=u;if(c.length||l.length){var p=c[0]||l[0];m+='<a class="'+(c[0]&&(c[0].url.includes(".gif")?"comment_gif":"comment_img")||"comment_sticker")+"\" href='"+p.url+"' data-rawwidth='"+(p.width||"")+"' data-rawheight='"+(p.height||"")+"'>"+(p.title||"图片")+"</a>"}var d=n(m,t,{rootCommentId:r,isConversation:i});d.then?d.then(function(){a&&a(),o.input?(o.input.reset(),o.resetImage(),o.setState({value:{toHTML:pt}},function(){return o.saveLocalComment()})):o.saveLocalComment({toHTML:pt})}):(a&&a(),o.input.reset()),qe.a.trackEvent(o,{action:"Comment",element:"Button"})}},void 0,ge.c),o.handleCommentShow=o.context.authRequired(function(){o.setState({shown:!0}),o.hiddenInput.focus()}),o.handleCommentHide=function(){o.setState({shown:!1})},o.initLocalComment=function(){var e=o.props,t=e.type,n=e.id;if(t&&n){var a=Ke.a.get(rt)||[],r=t+"_"+n,i=a.find(function(e){return e.key===r}),s=i&&i.value;s&&o.setState({value:{toHTML:function(){return s}},disabled:!1})}},o.saveLocalComment=function(e){var t=o.props,n=t.type,a=t.id;if(n&&a){var r=e?e.toHTML():o.state.value.toHTML(),i=n+"_"+a,s=(Ke.a.get(rt)||[]).filter(function(e){return e.key!==i}),c=r?[].concat(b(s.slice(0,it-1)),[{key:i,value:r}]):s;Ke.a.set(rt,c)}},o.handleChange=function(e){var t=o.state,n=t.sticker,a=t.images;n.length||a.length?o.setState({value:e}):o.setState({value:e,disabled:e.isEmpty}),o.handleInputChange()},o.handleFocus=function(){o.setState({active:!0}),o.handleInputChange()},o.handleBlur=function(){var e=o.state,t=e.sticker,n=e.images;t.length||n.length||(o.setState({active:!1}),o.handleInputChange())},o.handleMobileComment=function(){o.handleSubmit(),o.handleCommentHide()},o.resetUploadImg=function(){var e=o.state.value,t=void 0===e.isEmpty||e.isEmpty;o.setState({images:[],disabled:t}),o.imgUploadPopover.close()},o.handleImageUploadError=function(){var e=o.props.showNotification;o.updateUploadFetching("minus"),e("图片上传失败","red"),o.resetUploadImg()},o.handleEmotionClick=function(){o.state.stickerIconActive&&o.setState({stickerIconActive:!1},o.stickerPopover.close)},o.handleInputChange=function(){if(o.input){var e=Object(Be.findDOMNode)(o.input);e.getBoundingClientRect().height>40?o.setState({toggleInputStyle:!0}):o.setState({toggleInputStyle:!1});var t=e.innerText.length;o.setState({commentTextLength:t}),o.imgUploadPopover&&o.imgUploadPopover.position(),o.stickerPopover&&o.stickerPopover.position()}},o.renderMentionInputNum=function(){var e=o.state.commentTextLength;return ut-e>0?ue.a.createElement("p",{className:"CommentEditorV2-inputNum CommentEditorV2-inputNum--gyl"},"还可以输入：",ut-e):ue.a.createElement("p",{className:"CommentEditorV2-inputNum CommentEditorV2-inputNum--grd"},"已超出限制：",ut-e)},o.renderInput=function(e){var t=e.placeholder,n=e.className,a=o.props,r=a.autoFocus,i=a.stickers,s=o.state,c=s.images,l=s.sticker,u=s.stickerIconActive,m=s.toggleInputStyle,p=s.active,d=s.commentTextLength,f=Boolean(l.length)||Boolean(c.length);return ue.a.createElement("div",{className:he()("CommentEditorV2-inputWrap",{"CommentEditorV2-inputWrap--change":m,"CommentEditorV2-inputWrap--active":p}),onClick:function(e){e.nativeEvent.stopImmediatePropagation()}},ue.a.createElement(Qe.a,{className:he()("CommentEditorV2-input",n),defaultValue:o.state.value.toHTML(),richtext:!0,large:!0,spread:!0,allowMention:!0,autoFocus:Boolean(void 0)||r,outputBlockType:"div",onRef:function(e){o.input=e},placeholder:t,onFocus:o.handleFocus,onChange:o.handleChange,onSubmit:o.handleSubmit,minRows:5}),ue.a.createElement("div",{className:he()("CommentEditorV2-inputUpload",{"CommentEditorV2-inputUpload--FlexEnd":m,"CommentEditorV2-inputUpload--SpaceBetween":m&&d>mt,"CommentEditorV2-inputUpload--isFocus":p&&!f})},m&&d>mt&&o.renderMentionInputNum(),ue.a.createElement("div",{className:"CommentEditorV2-popoverWrap"},ue.a.createElement(He.a,{className:"CommentEditorV2-inputUpLoad-Img",arrowed:!0,ref:function(e){return o.imgUploadPopover=e},placement:"bottom",onClick:o.handleClickImageUpload,globalClose:!c.length,toggler:ue.a.createElement(Ye.a,{label:"插入图片",icon:$e.a,disabled:f})},c.length>0&&ue.a.createElement("div",{className:"CommentEditorV2-thumbnail"},ue.a.createElement(ot,{images:c,sourceType:"comment",onDelUploadImage:o.resetUploadImg,onImageUploaded:o.handleImageUploaded,onImageUploadError:o.handleImageUploadError}),ue.a.createElement("div",{className:"closeButton",onClick:o.resetUploadImg},ue.a.createElement($e.n,null)))),ue.a.createElement(He.a,{className:he()("CommentEditorV2-inputUpLoad-Icon",{"CommentEditorV2-inputUpLoad-Icon--active":u&&!l.length}),arrowed:!0,ref:function(e){return o.stickerPopover=e},globalClose:!l.length,preventCloseOnTarget:!0,onClick:o.handleEmotionClick,onOpen:o.handleStickerPopoverOpen,onClose:o.handleStickerPopoverClose,toggler:ue.a.createElement(Ye.a,{label:"插入表情",icon:$e.w,disabled:f}),placement:"bottom"},Boolean(l.length)&&ue.a.createElement("li",{className:"CommentEditorV2-stickersItem CommentEditorV2-stickersItem-single"},ue.a.createElement("img",{src:Object(Ge.a)(l[0].url),alt:l[0].title}),ue.a.createElement("div",{className:"closeButton",onClick:function(){o.resetStickers()}},ue.a.createElement($e.n,null))),!l.length&&ue.a.createElement("ul",{className:"CommentEditorV2-stickersWrap"},i.map(function(e){var t=e.url,n=e.title,a=e.id;return ue.a.createElement("li",{className:"CommentEditorV2-stickersItem",key:a,onClick:function(){o.addSticker(e)}},ue.a.createElement(Ze.a,{url:Object(Ge.a)(t),alt:n}),ue.a.createElement("p",null,n))}))))),ue.a.createElement("input",{type:"file",className:"CommentEditorV2-imageInput",ref:function(e){o.uploadInput=e},onClick:o.handleInputClick,onChange:o.handleUploadChange}))},o.handleStickerPopoverOpen=function(){o.setState({active:!0,stickerIconActive:!0},o.stickerPopover.position),setTimeout(o.stickerPopover.position,400)},o.handleStickerPopoverClose=function(){o.setState({stickerIconActive:!1})},o.handleInputClick=function(){o.setState({active:!0})},o.resetStickers=function(){var e=o.state.value,t=void 0===e.isEmpty||e.isEmpty;o.stickerPopover.close(),o.setState({sticker:[],disabled:t})},o.resetImage=function(){o.resetStickers(),o.resetUploadImg()},o.addSticker=function(e){o.setState({sticker:[e],disabled:!1},o.stickerPopover.position)},o.handleImageUploaded=function(e,t){var n=o.state.images,a=-1;n.find(function(e,n){return!(e.uid!==t||!e.file)&&(a=n,!0)}),-1!==a&&n.splice(a,1,ft({},e,{uid:t,file:null})),o.updateUploadFetching("minus"),o.setState({images:[].concat(b(n)),disabled:!1})},o.handleClickImageUpload=function(){o.setState({active:!0}),o.uploadInput.click()},o.updateUploadFetching=function(e,t){var n=o.state.uploadIsFetchingNum,a="add"===e?n+(t||1):Math.max(n-1,0);o.setState({uploadIsFetchingNum:a,active:!0})},o.handleUploadChange=function(){o.checkUploadFiles(o.uploadInput.files).then(function(e){var t=e.imageFiles;e.flag&&t.length>0?(o.setState({images:[].concat(b(t))},o.imgUploadPopover.position),o.updateUploadFetching("add",t.length)):o.imgUploadPopover.close(),o.resetFileInput()})},o.resetFileInput=function(){o.uploadInput.value=null},o.checkUploadFiles=function(e){var t=o.props.showNotification,n=[],a=!0;return e.length>1?(t("最多只能上传1张图片","red"),o.resetFileInput(),{flag:!1}):(Array.from(e).find(function(e){if(st.IMAGE.some(function(t){return e.name.toLowerCase().endsWith(t)})){if(e.size>lt.IMAGE)return t("请上传小于 "+ct+"M 的文件","red"),a=!1,!0;n.push({file:e,uid:dt()})}else t("暂不支持该文件格式","red")}),new Promise(function(e){e({flag:a,imageFiles:n})}))},a=n,C(o,a)}return E(t,e),ht(t,[{key:"componentDidMount",value:function(){this.initLocalComment(),this.handleInputChange(),document.addEventListener("click",this.handleBlur)}},{key:"componentWillUnmount",value:function(){this.saveLocalComment(),document.removeEventListener("click",this.handleBlur)}},{key:"render",value:function(){var e=this.props,t=e.replyTo,n=e.commentNeedsReview,o=e.className,a=e.ownerAuthorIsOrg,r=e.ownerAuthorIsBrand,i=(e.type,e.id,e.edition,e.shouldOia,e.location.query,e.referer,this.state),s=i.active,c=i.disabled,l=a?"机构":"作者",u={preset:"primary",color:"blue",children:"发布",disabled:c};if(t){var m=We()(vt,t.author.member.name,n?"，评论由"+l+"筛选后公开":"");return ue.a.createElement("div",{className:he()(o,"CommentEditorV2--normal",{"CommentEditorV2--active":s})},this.renderInput({placeholder:m}),ue.a.createElement(Fe.c,ft({},u,{className:"CommentEditorV2-singleButton",onClick:this.handleSubmit})))}var p="写下你的评论...";n&&(p=r?"已开启预审评论，评论由品牌筛选后公开":a?"已开启预审评论，评论由机构筛选后公开":"评论由作者筛选后显示");he()(o,"CommentEditorV2--normal"),this.state.shown;return ue.a.createElement("div",{className:he()(o,"CommentEditorV2--normal",{"CommentEditorV2--active":s})},this.renderInput({placeholder:p}),ue.a.createElement(Fe.c,ft({},u,{className:"CommentEditorV2-singleButton",onClick:this.handleSubmit})))}}]),t}(le.Component),J.propTypes={className:pe.a.string,defaultActive:pe.a.bool,replyTo:pe.a.object,inCommentItem:pe.a.bool,commentNeedsReview:pe.a.bool,canComment:pe.a.object,onCancel:pe.a.func,onSubmit:pe.a.func.isRequired},J.defaultProps={defaultActive:!1,replyTo:null,inCommentItem:!1,autoFocus:!0,ownerAuthorIsOrg:!1,ownerAuthorIsBrand:!1},J.contextTypes={authRequired:pe.a.func},$=Y))||$)||$),bt=(n(235),n(38),n(42)),gt=n(411),Ct=n(108),Et=n(36),wt=n(412),kt=n(239),Ot=n(47),Pt=(n(1413),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),It=function(e){function t(){var e,n,o,a;k(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=O(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={previewImg:null},o.handlePreview=function(e){var t=e.target;o.setState({previewImg:t})},a=n,O(o,a)}return P(t,e),Pt(t,[{key:"mount",value:function(){var e=this;this.imagesGifNode=this.root.getElementsByClassName("comment_gif"),this.imagesNode=this.root.getElementsByClassName("comment_img"),this.imagesStickerNode=this.root.getElementsByClassName("comment_sticker"),this.imagesNodes=Array.from([].concat(w(this.imagesGifNode),w(this.imagesNode),w(this.imagesStickerNode))).map(function(t){var n=document.createElement("div");n.className="Richtext-content_img",t.parentNode.replaceChild(n,t);var o=t.getAttribute("href"),a=new Image,r=t.getAttribute("class");return"comment_sticker"!==r&&n.addEventListener("click",e.handlePreview),a.classList.add(r),a.src=o,a.setAttribute("data-original",Object(Ge.a)(o,"r")),a.onload=function(){var e=a.width,t=a.height;e===t?n.classList.add("Richtext-content_img-square"):e>t?n.classList.add("Richtext-content_img-square--wideShape"):n.classList.add("Richtext-content_img-square--highShape"),n.appendChild(a)},n})}},{key:"unmount",value:function(){this.imagesNodes&&this.imagesNodes.forEach(function(e){Object(Be.unmountComponentAtNode)(e)})}},{key:"componentDidMount",value:function(){this.mount()}},{key:"componentWillUpdate",value:function(e){this.props.html!==e.html&&this.unmount()}},{key:"componentDidUpdate",value:function(e){e.html!==this.props.html&&this.mount()}},{key:"componentWillUnmount",value:function(){this.unmount()}},{key:"render",value:function(){var e=this,t=this.state.previewImg,n=this.props.html;return ue.a.createElement("div",{className:"CommentRichText",ref:function(t){return e.root=t}},ue.a.createElement(Ot.a,{html:n}),t&&ue.a.createElement(kt.a,{className:"CommentRichText-ImageView",img:t,onClose:function(){return e.setState({previewImg:null})}}))}}]),t}(le.Component),St=n(8),_t=(n(1414),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),Tt=(Z=Object(de.connect)(function(e){return{edition:Object(at.d)(e),referer:Object(at.i)(e),isWechat:e.env.userAgent.Wechat}}),Object(Ve.withRouter)(Q=Z((ee=X=function(e){function t(){var e,n,o,a;I(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=S(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={deleteModalShown:!1,reportModalShown:!1,isReplying:!1,collapsed:!0,guideShown:!1},o.toggleReply=o.context.authRequired(function(){o.setState({isReplying:!o.state.isReplying})},void 0,ge.c),o.openReportModal=o.context.authRequired(function(){o.setState({reportModalShown:!0})}),o.like=o.context.authRequired(function(e){var t=o.props;(0,t.onLike)(t.comment.id,e)},St.C.like,ge.c),o.dislike=o.context.authRequired(function(){var e=o.props;(0,e.onDislike)(e.comment.id)},St.C.like,ge.c),o.delete=function(){var e=o.props;(0,e.onDelete)(e.comment.id)},o.feature=function(){var e=o.props;(0,e.onFeature)(e.comment.id)},o.collapse=function(){var e=o.props;(0,e.onCollapse)(e.comment.id)},o.approve=function(){var e=o.props;(0,e.onApprove)(e.comment.id)},o.showConversation=function(e){var t=o.props;(0,t.onShowConversation)({commentId:t.comment.id,isAnchorComments:e})},o.stopReply=function(){o.setState({isReplying:!1})},o.openModal=function(){o.setState({deleteModalShown:!0})},o.closeModal=function(){o.setState({deleteModalShown:!1})},o.closeReportModal=function(){o.setState({reportModalShown:!1})},o.handleExpand=function(){o.setState({collapsed:!1})},o.handleToggleGuide=function(){o.setState({guideShown:!o.state.guideShown})},a=n,S(o,a)}return _(t,e),_t(t,[{key:"renderRoleInfo",value:function(e,t){return"normal"===e?null:ue.a.createElement("span",{className:"CommentItemV2-roleInfo"},"ancestor"===e||"author"===e&&"question"===t?" (提问者) ":" (作者) ")}},{key:"renderReplyTo",value:function(){var e=this.props.comment,t=e.replyToAuthor,n=e.resourceType;if(!t)return null;var o=t.member,a=void 0===o?{}:o,r=t.role;return ue.a.createElement("span",null,ue.a.createElement("span",{className:"CommentItemV2-reply"},"回复"),ue.a.createElement(Et.a,{className:he()({"CommentItemV2-userLink":void 0}),noBadge:!0,noHoverCard:!0,user:a}),this.renderRoleInfo(r,n))}},{key:"renderItem",value:function(){var e=this,t=this.props,n=t.comment,o=n.isDelete,a=n.collapsed,r=t.isConversation,i=t.ownerAuthorIsOrg;t.edition;if(o)return ue.a.createElement("div",{className:"CommentItemV2-deletedContent"},"这里有一条已删除的评论");if(a&&r&&this.state.collapsed)return ue.a.createElement("div",{className:"CommentItemV2-deletedContent"},"这里有一条已折叠的评论，",ue.a.createElement(Fe.c,{preset:"plain",onClick:this.handleExpand},"查看"));var s=this.state,c=s.deleteModalShown,l=s.reportModalShown,u=s.isReplying,m=this.props,p=m.parent,d=p.canComment;d=void 0===d?{status:!0}:d;var f=d.status,h=p.questionType,v=m.commentNeedsReview,y=m.comment,b=m.onReply,g=m.status,C=m.type,E=m.canOperate,w=m.commentPattern,k=m.isMobile,O=m.rootCommentId,P=m.byComment,I=m.isReverseAndStatusOpen,S=y.id,_=y.author,T=y.content,N=y.voteCount,j=y.replyToAuthor,R=y.isAuthor,x=y.isParentAuthor,A=y.createdTime,L=y.featured,D=y.voting,M=y.reviewing,F=y.disliked,U=y.resourceType,B=y.childCommentCount,V=_||{},q=V.member,z=V.role,W=Boolean(j),G=L&&(B>0||W)&&!r,K=P&&W,H=I&&W,$=G||K||H,J=void 0,Y=ue.a.createElement("div",{className:he()("CommentItemV2-footer",{"CommentItemV2-mobileFooter":void 0})},ue.a.createElement(Fe.c,{className:he()("CommentItemV2-likeBtn",D&&"is-liked"),preset:"plain",onClick:this.like,disabled:R},ue.a.createElement(Ae.a,{left:!0,name:"like"}),N>0?N:"赞"),$&&ue.a.createElement(Fe.c,{preset:"plain",className:"CommentItemV2-talkBtn",onClick:function(){return e.showConversation(W)}},ue.a.createElement(Ae.a,{left:!0,name:"comments",width:13}),"查看回复"),!R&&f&&!a&&ue.a.createElement(Fe.c,{preset:"plain",className:he()({"CommentItemV2-hoverBtn":!0}),onClick:this.toggleReply},ue.a.createElement(Ae.a,{left:!0,name:"reply"}),u?"取消回复":"回复"),x&&E&&!k&&ue.a.createElement(Fe.c,{className:he()({"CommentItemV2-hoverBtn":!R}),preset:"plain",onClick:this.feature},ue.a.createElement(Ae.a,{left:!0,name:"recommend"}),L?"取消推荐":"推荐"),x&&E&&!k&&ue.a.createElement(Fe.c,{className:he()({"CommentItemV2-hoverBtn":!R}),preset:"plain",onClick:this.collapse},ue.a.createElement(Ae.a,{left:!0,name:"inconspicuous"}),a?"取消折叠":"折叠"),!x&&!R&&E&&!k&&ue.a.createElement(Fe.c,{className:he()({"CommentItemV2-hoverBtn":!0}),preset:"plain",onClick:this.dislike},ue.a.createElement(Ae.a,{left:!0,name:"like",style:{transform:"rotate(180deg)"}}),F?"取消踩":"踩"),R||ue.a.createElement(gt.a,{className:he()({"CommentItemV2-hoverBtn":!0}),resourceType:C,type:"comment",id:S}),(R||x&&"question"!==C||x&&"question"===C&&"commercial"===h)&&!0&&ue.a.createElement(Fe.c,{className:he()({"CommentItemV2-hoverBtn":!R}),preset:"plain",onClick:this.openModal},ue.a.createElement(Ae.a,{left:!0,name:"trash"}),"删除"),void 0,void 0);return J=u?ue.a.createElement("div",null,Y,ue.a.createElement(yt,{type:"comment",id:S,commentNeedsReview:v,className:"CommentItemV2-editor",defaultActive:!0,replyTo:y,onCancel:this.stopReply,onSubmit:b,rootCommentId:O,isConversation:r})):"reviewing"===g?ue.a.createElement("div",{className:"CommentItemV2-footer"},ue.a.createElement(Fe.c,{preset:"plain",onClick:this.approve},ue.a.createElement(Ae.a,{left:!0,name:"read"}),"公开"),ue.a.createElement(Fe.c,{className:he()({"CommentItemV2-hoverBtn":!0}),preset:"plain",onClick:this.openModal},ue.a.createElement(Ae.a,{left:!0,name:"trash"}),"删除")):Y,ue.a.createElement("div",null,ue.a.createElement("div",{className:"CommentItemV2-meta"},q&&ue.a.createElement(Et.a,{className:"CommentItemV2-avatar",avatar:!0,noHoverCard:"fixed"===w,user:q}),q&&ue.a.createElement(Et.a,{className:he()({"CommentItemV2-userLink":void 0}),noBadge:!0,noHoverCard:!0,user:q}),this.renderRoleInfo(z,U),this.renderReplyTo(),M&&ue.a.createElement(Ae.a,{className:"CommentItemV2-reviewing",name:"inconspicuous","data-tooltip":!1===i?"评论未公开，由作者筛选后显示":"已开启预审评论，评论由机构筛选后公开"}),ue.a.createElement("span",{className:"CommentItemV2-time"},Object(bt.c)(A))),ue.a.createElement("div",{className:"CommentItemV2-metaSibling"},ue.a.createElement(It,{className:"CommentItemV2-content",html:T}),J,ue.a.createElement(wt.a,{title:"你确定要删除这条评论吗？",shown:c,onCancel:this.closeModal,onSubmit:this.delete}),ue.a.createElement(Ct.a,{resourceType:U,type:"comment",urlToken:S,shown:l,onClose:this.closeReportModal,zaEnabled:!0})))}},{key:"render",value:function(){var e=this.props,t=(e.parent,e.parent);t.type,t.id,e.isWechat,e.edition,e.referer,e.location.query;return this.renderItem()&&ue.a.createElement("div",{className:"CommentItemV2",ref:this.props.onRef},this.renderItem(),void 0)}}]),t}(le.Component),X.propTypes={comment:pe.a.object.isRequired,parent:pe.a.object.isRequired,commentNeedsReview:pe.a.bool,type:pe.a.string,isConversation:pe.a.bool,onLike:pe.a.func.isRequired,onShowConversation:pe.a.func,onReply:pe.a.func,onFeature:pe.a.func,onDelete:pe.a.func.isRequired,onCollapse:pe.a.func,commentPattern:pe.a.string,isMobile:pe.a.bool},X.contextTypes={currentUser:pe.a.object,authRequired:pe.a.func},Q=ee))||Q)||Q),Nt=n(1121),jt=n(385),Rt=n(76),xt=n(63),At=(n(1415),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),Lt=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Dt=(te=Object(de.connect)(L,{loadComments:r,loadConversation:u,addComment:i,loadStickers:a,clearNotification:ge.e}))((ae=oe=function(e){function t(){var e,n,o,a;R(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=x(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={collapsed:!0,current:1,packupButtonStatus:!1,packupButtonLeft:0},o.load=function(e,t,n){if(!o.props.isFetching&&!o.props.parent.adminClosedComment){var a=e||o.props,r=a.order,i=a.byComment,s=a.status,c=a.parent,l=c.id,u=c.type,m=a.commentPattern,p=a.needLoadCommentPermission,d=a.byCommentLimit,f=a.loadComments,h=a.dispatch;if(p&&T(u,l)&&h(T(u,l)),n){f(u,l,{order:r,isPrevious:t,byComment:i,status:"collapsed",commentPattern:m,byCommentLimit:d},!0)}else f(u,l,{order:r,isPrevious:t,byComment:i,status:s,commentPattern:m,byCommentLimit:d})}},o.addComment=function(e,t,n){var a=n.rootCommentId,r=n.isConversation,i=o.props,s=i.parent,c=s.id,l=s.type,u=i.commentId;return(0,i.addComment)({parentType:l,parentId:c,content:e,replyTo:t,conversationId:u,rootCommentId:a,isConversation:r,replyType:N({id:a,replyTo:t,isConversation:r}).type})},o.featureItem=function(e){(0,o.props.onItemFeature)(e,o.lastFeaturedIndex)},o.handleOpenCollapsed=function(){o.setState({collapsed:!1}),o.load(o.props,!1,!0)},o.handleScroll=function(){if(o.commentsElement&&o.commentsWithPaginationEl){var e=window.innerHeight,t=o.state.packupButtonStatus,n=o.commentsWithPaginationEl.getBoundingClientRect(),a=n.top,r=n.bottom,i=n.height;!t&&i>500&&r>e&&a<0?o.setState({packupButtonStatus:!0}):t&&(i<=500||r<=e||a>=0)&&o.setState({packupButtonStatus:!1})}},o.createOnRef=Te()(function(e){return function(t){var n=o.props.byComment;parseInt(e)===Number(n)&&(o.targetCommentEl=t)}}),o.handlePaginationClick=function(e){var t=o.props.onPaginationClick,n=o.state.current;t&&t(n,e),o.commentsElement.scrollIntoView(),o.setState({current:e}),o.loadByPagination(e)},o.loadByPagination=function(e,t){var n=t||o.props,a=n.order,r=n.byComment,i=n.status,s=n.parent,c=s.id,l=s.type,u=n.commentPattern,m=n.needLoadCommentPermission,p=n.byCommentLimit,d=n.loadComments,f=n.dispatch;m&&f(T(l,c)),d(l,c,{order:a,isPrevious:!1,byComment:r,status:i,commentPattern:u,current:e,byCommentLimit:p})},o.loadRestComments=function(e){var t=e.commentId;(0,o.props.loadConversation)({id:t,isLoadRest:!0})},o.renderComment=function(e){var t=o.props,n=t.parent,a=n.type,r=n.author;r=void 0===r?{isOrg:!1}:r;var i=r.isOrg,s=t.isMobile,c=t.parent,l=t.commentNeedsReview,u=t.onShowConversation,m=t.status,p=t.onItemLike,d=t.onItemDelete,f=t.onItemCollapse,h=t.onItemDislike,v=t.onItemApprove,y=t.canOperateItem,b=t.commentPattern,g=t.conversation,C=void 0===g?{}:g,E=t.entities,w=t.byComment,k=t.isReverseAndStatusOpen,O=e.id,P=e.featured,I=e.childComments,S=void 0===I?[]:I,_=e.childCommentCount,T=void 0===_?0:_,N=P?O+"_featured":O,j=Boolean(S.length)&&!k,R=T<=5&&T>2,x=S.map(function(e){return E.comments[e]}),A=!P&&T>2&&!k,L=R&&C[O]||{isFetching:!1},D=L.isFetching;return ue.a.createElement("ul",{className:"CommentsV2-CommentItemV2",key:N},ue.a.createElement("li",{className:he()({"CommentsV2-CommentItemV2--rootCommentNoChild":!j,"CommentsV2-CommentItemV2--rootComment":j}),key:N},ue.a.createElement(Tt,{key:N,isMobile:s,comment:e,onRef:o.createOnRef(N),status:m,type:a,parent:c,canOperate:y,commentNeedsReview:l,onShowConversation:u,ownerAuthorIsOrg:i,onLike:p,onReply:o.addComment,onFeature:o.featureItem,onDelete:d,onCollapse:f,onDislike:h,onApprove:v,commentPattern:b,rootCommentId:O,byComment:w,isReverseAndStatusOpen:k})),j&&x.map(function(e){var t=e.id,n=e.featured,r=n?t+"_featured":t;return ue.a.createElement("li",{className:"CommentsV2-CommentItemV2--child",key:r},ue.a.createElement(Tt,{key:r,isMobile:s,comment:e,onRef:o.createOnRef(r),status:m,type:a,parent:c,canOperate:y,commentNeedsReview:l,onShowConversation:u,ownerAuthorIsOrg:i,onLike:p,onReply:o.addComment,onFeature:o.featureItem,onDelete:d,onCollapse:f,onDislike:h,onApprove:v,commentPattern:b,rootCommentId:O}))}),A&&o.renderMoreCommentsButton({comment:e,isloadRestCommentsFetching:D,key:N}))},o.renderMoreCommentsButton=function(e){var t=e.comment,n=e.isloadRestCommentsFetching,a=e.key,r=o.props.onShowConversation,i=o.state["hideExpandButton_"+a],s=t.id,c=t.childCommentCount,l=c<=5&&c>2,u=l?o.loadRestComments:r,m=l?"展开其他 "+(c-2)+" 条回复":"查看全部 "+c+" 条回复";return ue.a.createElement(le.Fragment,null,!i&&ue.a.createElement("li",{className:"CommentsV2-moreReplyButton"},ue.a.createElement(Fe.c,{preset:"plain",onClick:function(){u({commentId:s}),l&&o.setState(j({},"hideExpandButton_"+a,!0))}},m)),n&&ue.a.createElement(Le.a,{className:"CommentsV2-moreReplyButton",small:!0}))},o.renderNormalComments=function(e){var t=o.state.collapsed,n=o.props,a=n.byComment,r=n.lastFeaturedIndex,i=[];return o.lastFeaturedIndex=0,e.length>0&&e.forEach(function(n,s){if(a||!n.collapsed){var c=e[s-1];n.collapsed&&(c&&c.collapsed||i.push(o.renderCollapsedDivider()),t)||(s===r&&i.push(ue.a.createElement("div",{className:"CommentsV2-CommentItemV2-nextSiblings--noBorder",key:"CommentsV2-CommentItemV2-nextSiblings--noBorder"})),i.push(o.renderComment(n)),s===r&&(o.lastFeaturedIndex=s,i.push(ue.a.createElement("div",{className:"CommentListV2-divider",key:"divider-featured"},ue.a.createElement("div",{className:"CommentListV2-dividerLine"}),ue.a.createElement("div",{className:"CommentListV2-dividerText"},"以上为精选评论",ue.a.createElement(Ae.a,{className:"CommentListV2-questionMark",name:"questionMark","data-tooltip":"精选评论包含回答作者推荐的评论和部分高赞评论"}))))))}}),i},o.renderCollapsedComments=function(){var e=[],t=o.props.collapsedComments;return o.state.collapsed||!t||t.length<=0?[]:(e.push(t.map(function(e){return o.renderComment(e)})),e)},o.renderComments=function(e){return e.map(o.renderComment)},o.renderCollapsedDivider=function(){var e=o.props,t=e.isDrained,n=e.parent.collapsedCounts;return!t||n<=0?[]:o.state.collapsed?ue.a.createElement("div",{className:"CommentListV2-action",key:"collapsed"},ue.a.createElement("div",{className:"CommentListV2-expendCollapseButton"},ue.a.createElement("span",{onClick:o.handleOpenCollapsed},Object(Me.a)(n)," 条评论被折叠"),"（",ue.a.createElement("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）")):ue.a.createElement("div",{className:"CommentListV2-divider",key:"divider-collapsed"},ue.a.createElement("div",{className:"CommentListV2-dividerLine"}),ue.a.createElement("div",{className:"CommentListV2-dividerText"},Object(Me.a)(n)," 条评论被折叠（",ue.a.createElement("a",{href:"//www.zhihu.com/question/52029856/answer/128623557",target:"_blank",rel:"noopener noreferrer"},"为什么？"),"）"))},o.renderCollapsedInfiLoader=function(){var e=o.state.collapsed;if(e)return[];var t=o.props.collapsedInfo;t=void 0===t?{}:t;var n=t.isFetching,a=t.isPrevDrained,r=t.isDrained;return ue.a.createElement(Le.b,{className:"CommentListV2",onRef:function(e){o.listEl=e},isLocal:!0,isLoading:n,isPrevDrained:a,isDrained:r,onLoad:function(t){return o.load(o.props,t,!e)},placeholder:ue.a.createElement(Le.a,{className:"CommentItem",small:!0})},o.renderCollapsedComments())},o.renderPatternContent=function(e){var t=o.props,n=t.isFetching,a=t.parent.adminClosedComment,r=t.byComment,i=t.status,s=t.order,c=t.totals,l=t.handlePackupButton,u=t.apps,m=Math.ceil(c/20),p=o.state,d=p.current,f=p.packupButtonStatus,h=p.packupButtonLeft;return a?null:n?ue.a.createElement(Nt.a,{onRef:function(e){o.commentsWithPaginationEl=e}}):ue.a.createElement("div",{ref:function(e){o.commentsWithPaginationEl=e}},ue.a.createElement("div",{className:"CommentListV2"},"normal"===s&&"open"===i?o.renderNormalComments(e):o.renderComments(e)),m>1&&ue.a.createElement(De.a,{current:d,className:"CommentsV2-pagination",total:m,clickCallback:o.handlePaginationClick}),!r&&o.renderCollapsedDivider(),!r&&o.renderCollapsedInfiLoader(),ue.a.createElement(Ie.CSSTransitionGroup,{transitionName:"CommentsV2-Packup-Button",transitionEnterTimeout:300,transitionLeaveTimeout:300},f&&"column"!==u&&ue.a.createElement("button",{onClick:l,className:"CommentsV2-Packup-Button",style:{left:h}},"收起评论",ue.a.createElement(Ae.a,{name:"arrow"}))))},o.renderModalContent=function(e){var t=o.props,n=t.collapsedInfo,a=t.parent.adminClosedComment,r=t.status,i=t.order,s=t.byComment,c=o.state.collapsed,l=c?o.props:n,u=l.isFetching,m=l.isDrained,p=l.isPrevDrained;if(m&&e.length<=0||a)return ue.a.createElement("div",{className:"CommentsV2-empty"},ue.a.createElement(Ue.a,{entityType:"comments"}));var d={getContainer:function(e){return e}};return ue.a.createElement(Le.b,At({className:"CommentListV2",onRef:function(e){o.listEl=e},isLocal:!0,isLoading:u,isPrevDrained:p,isDrained:m,onLoad:function(e){return o.load(o.props,e,!c)},placeholder:ue.a.createElement(Le.a,{className:"CommentItemV2",small:!0})},d),"normal"===i&&"open"===r?o.renderNormalComments(e):o.renderComments(e),!s&&o.renderCollapsedDivider(),!s&&o.renderCollapsedComments())},o.renderCommentEdit=function(){var e=o.props,t=e.parent,n=t.canComment;n=void 0===n?{status:!0}:n;var a=n.status,r=n.reason,i=t.author;i=void 0===i?{isOrg:!1}:i;var s=i.isOrg,c=t.type,l=t.id,u=t.adminClosedComment,m=t.questionType,p=e.byComment,d=e.isAutoblur,f=e.commentNeedsReview,h=u?"当前内容暂时无法评论":r,v=d?!d:!p;return a&&!u?ue.a.createElement(yt,{className:"CommentsV2-footer",type:c,id:l,commentNeedsReview:f,onSubmit:o.addComment,autoFocus:v,ownerAuthorIsOrg:s,ownerAuthorIsBrand:"commercial"===m}):ue.a.createElement("div",{className:he()("CommentsV2-disabledText",{"CommentsV2-disabledText--fixed":void 0})},ue.a.createElement("div",{className:"CommentsV2-disabledReason"},h))},a=n,x(o,a)}return A(t,e),Lt(t,[{key:"componentDidMount",value:function(){this.subscription=Object(Se.subscribe)("scroll",this.handleScroll);var e=this.props,t=e.commentPattern,n=e.parent.adminClosedComment,o=e.stickers,a=e.loadStickers,r=this.state.current;"bottom"!==t||n||(this.loadByPagination(r),this.commentsWithPaginationEl&&this.setState({packupButtonLeft:this.commentsWithPaginationEl.getBoundingClientRect().right-16})),!o.length&&a()}},{key:"componentWillReceiveProps",value:function(e){var t=this.props,n=t.order,o=t.status,a=t.targetComment,r=t.commentPattern;n===e.order&&o===e.status||("bottom"===r?(this.setState({current:1}),this.loadByPagination(1,e)):this.load(e),this.setState({collapsed:!0}));var i=e.targetComment;!a&&i&&this.setState({collapsed:!i.collapsed})}},{key:"componentWillUnmount",value:function(){Object(ge.e)(ge.c),this.subscription&&this.subscription.unsubscribe()}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.isAuthor,a=t.comments,r=t.commentPattern,i=t.parent,s=i.author;s=void 0===s?{isOrg:!1}:s;var c=s.isOrg,l=i.commentPermission,u=i.reviewingCounts,m=i.commentCount,p=i.adminClosedComment,d=t.totals,f=t.status,h=t.order,v=t.onStatusChange,y=t.apps,b=t.onOrderChange,g=t.targetLink,C=t.shouldReverse,E=a.filter(function(e){return!e.isDelete}),w="censor"===l&&o,k=w?{isCommentReviewer:w,onStatusChange:v,status:f,reviewingCounts:u}:{status:f};return ue.a.createElement("div",{className:he()("CommentsV2 CommentsV2--withEditor",{"CommentsV2-withPagination":"bottom"===r},n),ref:function(t){e.commentsElement=t}},ue.a.createElement(jt.a,At({commentCount:void 0!==m?m:d,shouldReverse:C,commentClosed:p,targetLink:g,order:h,onOrderChange:b,commentPattern:r,isOrg:c},k)),"column"===y&&this.renderCommentEdit(),"bottom"===r?this.renderPatternContent(E):this.renderModalContent(E),"column"!==y&&this.renderCommentEdit())}}]),t}(le.Component),oe.propTypes={type:pe.a.string,parent:pe.a.object.isRequired,targetLink:pe.a.node,commentNeedsReview:pe.a.bool,byComment:pe.a.oneOfType([pe.a.number,pe.a.string]),commentPattern:pe.a.string,handlePackupButton:pe.a.func,onPaginationClick:pe.a.func,isAutoblur:pe.a.bool,shouldReverse:pe.a.bool},oe.contextTypes={authRequired:pe.a.func.isRequired},oe.defaultProps={isAutoblur:!1,shouldReverse:!0},ne=ae))||ne,Mt=n(400),Ft=n.n(Mt),Ut=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Bt=(re=Object(de.connect)(B,{loadConversation:u,addComment:i,loadMoreAnchorComments:m}))((ce=se=function(e){function t(){var e,n,o,a;M(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=F(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.load=function(){var e=o.props,t=e.isAnchorComments,n=e.commentId;(0,e.loadConversation)({id:n,isAnchorComments:t})},o.addComment=function(e,t,n){var a=n.rootCommentId,r=n.isConversation,i=o.props,s=i.parent,c=s.type,l=s.id,u=i.commentId,m=i.addComment,p=i.isAnchorComments;return m({parentType:c,parentId:l,content:e,replyTo:t,conversationId:u,rootCommentId:a,isConversation:r,replyType:N({id:a,replyTo:t,isConversation:r}).type,isAnchorComments:p})},o.loadMoreAnchorComments=function(){var e=o.props,t=e.commentId,n=e.topCommentsPaging,a=void 0===n?{}:n;(0,e.loadMoreAnchorComments)({commentId:t,nextUrl:a.next})},o.createOnRef=Te()(function(e){return function(t){var n=o.props.byComment;parseInt(e)===Number(n)&&(o.targetCommentEl=t)}}),o.scrollToTarget=function(){var e=o,t=e.targetCommentEl,n=e.listEl;if(n&&t){var a=t.getBoundingClientRect(),r=a.top,i=a.height,s=n.getBoundingClientRect(),c=s.top,l=s.height;o.listEl.scrollTop+=r-c-(l-i)/2,t.classList.add("CommentItemV2--highlighted"),setTimeout(function(){return t.classList.remove("CommentItemV2--highlighted")},2e3),t.tabIndex=-1,t.focus()}},a=n,F(o,a)}return U(t,e),Ut(t,[{key:"componentDidMount",value:function(){this.props.byComment&&this.scrollToTarget()}},{key:"componentDidUpdate",value:function(e){!e.comments.length&&this.props.comments.length&&this.props.byComment&&this.scrollToTarget()}},{key:"render",value:function(){var e=this,t=this.props,n=t.onItemLike,o=t.onItemDelete,a=t.onItemFeature,r=t.onItemApprove,i=t.onItemCollapse,s=t.onItemDislike,c=t.onNavBack,l=t.canOperateItem,u=t.isFetching,m=t.comments,p=void 0===m?[]:m,d=t.commentNeedsReview,f=t.openComment.collapsed,h=t.parent,v=t.commentPattern,y=t.totals,b=t.isDrained,g=t.isPrevDrained,C=t.isConversationMoreFetching,E=t.isConversationMoreDrained,w=t.offsetIndex,k=null;return u&&!p.length?k=ue.a.createElement(le.Fragment,null,ue.a.createElement(Le.a,{className:"CommentItemV2",small:!0}),ue.a.createElement("div",{className:"CommentsV2-openComment-divider"}),ue.a.createElement("div",{className:"CommentsV2-replyNum"},y+" 条回复")):p.length&&(k=p.map(function(t,c){return c?E||c!==w||C?C&&c===w?ue.a.createElement(le.Fragment,{key:t.id},ue.a.createElement(Tt,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:d,canOperate:l,parent:h,comment:t,onLike:n,onDelete:o,onFeature:a,onApprove:r,onCollapse:i,onDislike:s,collapsedShown:f,onReply:e.addComment}),ue.a.createElement(Le.a,{key:"CoommentsV2-moreCommentButton-PlaceHolder",className:"CoommentsV2-moreCommentButton ",small:!0})):ue.a.createElement(Tt,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:d,canOperate:l,parent:h,comment:t,onLike:n,onDelete:o,onFeature:a,onApprove:r,onCollapse:i,onDislike:s,collapsedShown:f,onReply:e.addComment}):ue.a.createElement(le.Fragment,{key:t.id},ue.a.createElement(Tt,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:d,canOperate:l,parent:h,comment:t,onLike:n,onDelete:o,onFeature:a,onApprove:r,onCollapse:i,onDislike:s,collapsedShown:f,onReply:e.addComment}),ue.a.createElement("div",{key:"CoommentsV2-moreCommentButton",preset:"plain",className:"CoommentsV2-moreCommentButton",onClick:e.loadMoreAnchorComments},ue.a.createElement($e.c,null),ue.a.createElement("p",null,"点击查看更多回复"))):ue.a.createElement(le.Fragment,{key:t.id},ue.a.createElement("div",{className:"CommentsV2-openComment"},ue.a.createElement(Tt,{key:t.id,onRef:e.createOnRef(t.id),isConversation:!0,commentNeedsReview:d,canOperate:l,parent:h,comment:t,onLike:n,onDelete:o,onFeature:a,onApprove:r,onCollapse:i,onDislike:s,collapsedShown:f,onReply:e.addComment})),ue.a.createElement("div",{className:"CommentsV2-openComment-divider"}),ue.a.createElement("div",{key:t.id+"-title"},ue.a.createElement("div",{className:"CommentsV2-replyNum"},y+" 条回复")))})),"bottom"===v?ue.a.createElement(Je.b,{size:"fullPage",onClose:c},ue.a.createElement("div",{className:"CommentsV2"},ue.a.createElement(jt.a,{isConversation:!0,commentPattern:v}),ue.a.createElement(Le.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:u,isDrained:b,isPrevDrained:g,onLoad:this.load,placeholder:ue.a.createElement(Le.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e}},k))):ue.a.createElement("div",{className:"CommentsV2"},ue.a.createElement(jt.a,{isConversation:!0,onNavBack:c}),ue.a.createElement(Le.b,{className:"CommentListV2",onRef:function(t){e.listEl=t},isLocal:!0,isLoading:u,isDrained:b,isPrevDrained:g,onLoad:this.load,placeholder:ue.a.createElement(Le.a,{className:"CommentItemV2",small:!0}),getContainer:function(e){return e}},k))}}]),t}(le.Component),se.propTypes={commentId:pe.a.number.isRequired,type:pe.a.string,parent:pe.a.object.isRequired,commentNeedsReview:pe.a.bool},se.contextTypes={currentUser:pe.a.object,authRequired:pe.a.func.isRequired},ie=ce))||ie;n.d(t,"default",function(){return Ht});var Vt,qt,zt,Wt,Gt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Kt=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Ht=(Vt=Object(de.connect)(function(e){return e},{updateCommentLikeStatus:s,updateCommentFeatureStatus:p,deleteComment:l,updateCommentCollapsed:d,updateCommentDisliked:c,approveComment:f}))((Wt=zt=function(e){function t(){var e,n,o,a;q(this,t);for(var r=arguments.length,i=Array(r),s=0;s<r;s++)i[s]=arguments[s];return n=o=z(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(i))),o.state={openedCommentId:null,isAnchorComments:!1,status:"open",order:"normal"},o.showConversation=function(e){var t=e.commentId,n=e.isAnchorComments;o.setState({openedCommentId:t,isAnchorComments:n})},o.showComments=function(){o.setState({openedCommentId:null,isAnchorComments:!1})},o.delete=function(e){var t=o.props,n=t.parent;(0,t.deleteComment)(e,n.type,n.id)},o.feature=function(e,t){var n=o.props,a=n.parent;(0,n.updateCommentFeatureStatus)(e,a.id,a.type,t)},o.like=function(e,t){var n=o.props,a=n.onItemLike,r=n.updateCommentLikeStatus;a&&a(e,t),r(e)},o.collapse=function(e){var t=o.props,n=t.parent;(0,t.updateCommentCollapsed)(e,n.type,n.id)},o.dislike=function(e){(0,o.props.updateCommentDisliked)(e)},o.approve=function(e){var t=o.props,n=t.parent,a=t.type;(0,t.approveComment)(e,n.type||a,n.id)},o.handleStatusChange=function(e){o.setState({status:e})},o.handleOrderChange=function(e,t){var n=o.props.onOrderChange;n&&n(e,t),o.setState({order:e})},a=n,z(o,a)}return W(t,e),Kt(t,[{key:"componentDidMount",value:function(){var e=this.props.onMount;e&&e(this.commentsContainerNode)}},{key:"render",value:function(){var e=this,t=this.props,n=t.parent,o=t.commentPattern,a=t.type,r=t.parent;r=void 0===r?{}:r;var i=r.commentPermission,s=r.relationship,c=void 0===s?{}:s,l=r.author,u=void 0===l?{}:l,m=t.needLoadCommentPermission,p=t.byComment,d=V(t,["parent","commentPattern","type","parent","needLoadCommentPermission","byComment"]),f=this.context.currentUser,h=void 0===c.isAuthor?f&&u.urlToken&&f.urlToken===u.urlToken:c.isAuthor,v="censor"===i&&!h,y="answer"===a||"article"===a,b=this.state,g=b.openedCommentId,C=b.status,E=b.order,w=b.isAnchorComments,k=w&&(g||p)||p;return ue.a.createElement("div",{className:"Comments-container",ref:function(t){return e.commentsContainerNode=t}},ue.a.createElement(Dt,Gt({className:he()({"CommentsV2--hidden":g&&"bottom"!==o})},d,{type:a,order:E,status:C,parent:n,commentPattern:o,commentNeedsReview:v,canOperateItem:y,onShowConversation:this.showConversation,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve,byComment:k,onStatusChange:this.handleStatusChange,onOrderChange:this.handleOrderChange,needLoadCommentPermission:m,isAuthor:h})),g&&ue.a.createElement(Bt,Gt({},d,{parent:n,type:a,canOperateItem:y,onItemLike:this.like,onItemFeature:this.feature,onItemDelete:this.delete,onItemCollapse:this.collapse,onItemDislike:this.dislike,onItemApprove:this.approve,commentPattern:o,commentId:g,onNavBack:this.showComments,byComment:k,isAnchorComments:w,commentNeedsReview:v,onShowConversation:this.showConversation})))}}]),t}(le.Component),zt.propTypes={type:pe.a.string.isRequired,parent:pe.a.object.isRequired,onOrderChange:pe.a.func,onItemLike:pe.a.func,isAuthor:pe.a.bool,onMount:pe.a.func},zt.defaultProps={type:"answer"},zt.contextTypes={currentUser:pe.a.object,authRequired:pe.a.func.isRequired},qt=Wt))||qt},1428:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e){return Array.isArray(e)||(e=[e]),e.map(function(e,t){return c.a.createElement("span",{className:"PushNotifications-actor",key:t},e.link?c.a.createElement("a",{href:e.link},e.name):c.a.createElement("span",null,e.name))})}Object.defineProperty(t,"__esModule",{value:!0});var s=n(0),c=n.n(s),l=n(2),u=n.n(l),m=n(413),p=(n.n(m),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),d=function(e){function t(){var e,n,r,i;o(this,t);for(var s=arguments.length,l=Array(s),u=0;u<s;u++)l[u]=arguments[u];return n=r=a(this,(e=t.__proto__||Object.getPrototypeOf(t)).call.apply(e,[this].concat(l))),r.renderTarget=function(){var e=r.props.item,t=e.content.target,n=t.text,o=t.link,a=e.id,i=e.target,s=e.target;s=void 0===s?{}:s;var l=s.id,u=s.target,m=void 0===u?{}:u,p=m.type;return i&&"comment"===i.type?r.renderCommentButton(n,{type:p,href:o,byComment:l,target:m,notificationId:a}):c.a.createElement("span",null,o?c.a.createElement("a",{href:o},n):c.a.createElement("span",null,n))},i=n,a(r,i)}return r(t,e),p(t,[{key:"renderCommentButton",value:function(e,t){var n=this,o=t.href,a=t.byComment,r=t.notificationId;return c.a.createElement("a",{href:o+(a?"#comment-"+a+"?notificationId="+r:""),onClick:function(e){e.preventDefault(),n.props.onCommentsModalOpen(t)}},e)}},{key:"render",value:function(){var e=this.props.item,t=e.content,n=t.verb,o=t.actors,a=e.isRead;return c.a.createElement("div",{className:u()("PushNotifications-item",{"PushNotifications-newItem":!a})},c.a.createElement("span",null,i(o))," ",n," ",this.renderTarget())}}]),t}(s.Component);t.default=d},1429:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){return e?t?!0===t?"":t:e:""}function s(e){for(var t,n=e.length,o=e.chars,a=e.maskChar,r=[],s=0;s<n;s+=1)t=o[s],r.push(C.a.createElement("span",{className:O()("TPassBox",{"TPassBox-mask":t&&Boolean(a)}),key:s},i(t,a)));return C.a.createElement("span",{className:"TPassBoxes"},r)}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function u(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function f(){this.payments={},this.chosePaymentName=null,this.codeUrl="",this.qrLoaded=!1,this.need=null,this.passcode="",this.needSMS=!1,this.smsTimer=0,this.isInProgress=!1,this.error=null}function h(e,t){return G&&e&&e!==G&&t(new Error("A pay-sdk from different source has been load")),G=e,window.zhihu&&window.zhihu.pay?window.zhihu.pay.ready(t):(K||(K=Object(W.a)(e)),K.then(function(){return window.zhihu.pay.ready(t)},function(e){t(e),K=null}))}function v(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function b(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var g=n(0),C=n.n(g),E=n(1),w=n.n(E),k=n(2),O=n.n(k),P=n(3),I=n(33),S=n(396),_=n(104),T=n(19),N=(n(1416),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),j={backspace:8,tab:9,enter:13,0:48,9:57},R=function(e){function t(e){o(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onInputFocus=n.onInputFocus.bind(n),n.onInputChange=n.onInputChange.bind(n),n.onKeyDown=n.onKeyDown.bind(n),n}return r(t,e),N(t,[{key:"onInputFocus",value:function(e){e.target.value=e.target.value,this.props.onFocus()}},{key:"onInputChange",value:function(e){var t=String(e.target.value);if(t){t=t[t.length-1];var n=this.props.chars,o=this.props.length;n.length===o?n=n.replace(/.$/,t):n+=t,this.props.onChange(n),n.length===o&&this.props.onFinish(n)}}},{key:"onKeyDown",value:function(e){var t=e.keyCode;if(!e.metaKey&&!e.ctrlKey&&t!==j.tab&&t!==j.enter){var n=this.props.chars;t===j.backspace?(n=n.slice(0,-1),this.props.onChange(n)):(t<j[0]||t>j[9])&&(e.preventDefault(),this.props.onError(e))}}},{key:"focus",value:function(){this.input.focus()}},{key:"blur",value:function(){this.input.blur()}},{key:"render",value:function(){var e=this,t=this.props,n=t.length,o=t.chars,a=t.maskChar,r=t.autoFocus,i=t.className,c=t.children,l=o.length===n?n-1:o.length,u=o[l]||"";return C.a.createElement("label",{className:O()("TPass",i)},C.a.createElement("span",{className:"TPass-wrapper"},C.a.createElement(s,{length:n,chars:o,maskChar:a}),C.a.createElement("input",{className:"TPass-input",value:u,style:{left:60*l},onFocus:this.onInputFocus,onChange:this.onInputChange,onKeyDown:this.onKeyDown,onPaste:function(e){return e.preventDefault()},type:"number",min:"0",max:"9",pattern:"[0-9]*",autoFocus:r,ref:function(t){e.input=t}})),c)}}]),t}(C.a.Component);R.defaultProps={length:6,chars:"",maskChar:!1,autoFocus:!1,onFocus:function(){},onChange:function(){},onError:function(){},onFinish:function(){}},R.propTypes={length:w.a.number,chars:w.a.string,maskChar:w.a.oneOfType([w.a.bool,w.a.string]),autoFocus:w.a.bool,onFocus:w.a.func,onChange:w.a.func,onError:w.a.func,onFinish:w.a.func,className:w.a.string,children:w.a.node};var x,A,L=R,D=(n(1417),function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}()),M=(A=x=function(e){function t(){return c(this,t),l(this,(t.__proto__||Object.getPrototypeOf(t)).apply(this,arguments))}return u(t,e),D(t,[{key:"render",value:function(){var e=this.props;return C.a.createElement("div",{className:O()("Spinner",e)},C.a.createElement("i",{className:"Spinner-loading"}))}}]),t}(g.Component),x.propTypes={className:w.a.string},A),F=n(156),U=(n(1418),Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e}),B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},V=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),q=function(e){function t(e){m(this,t);var n=p(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onPasscodeFocus=function(){n.state.error&&(n.setState({error:null}),6===n.state.passcode.length&&n.setState({passcode:""}))},n.onPasscodeInput=function(e){"object"===(void 0===e?"undefined":B(e))&&(e=e.target.value),n.setState({passcode:e})},n.onPasscodeFinish=function(e){n.tpass.blur(),n.payWithBalance(e)},n.onSendSMSCode=function(){n.props.trade.resendSMSCode(function(){n.startSMSTimer(),n.smsInput.focus()},function(e){n.setState({error:e})})},n.onQrLoad=function(){n.setState({qrLoaded:!0})},n.onBalanceFormSubmit=function(e){e.preventDefault(),n.payWithBalance(n.state.passcode)},n.setPayments=function(e){n.setState({payments:e})},n.confirmPayment=function(){var e=n.state,t=e.choseName,o=e.payments,a=n.props.onConfirmPayment,r=t;t||(r=o.balance&&o.balance.enable?"balance":"wechat"),a(!r),n.setState({chosePaymentName:r}),n.props.trade["wechat"===r?"initWechatPay":"initBalancePay"]()},n.pid=0,n.smsTimer=null,n.state=new f,n.isInWechat=e.ua.Wechat,n}return d(t,e),V(t,[{key:"componentWillMount",value:function(){var e=this.props.trade;this.getPaymentsList(e),this.initListeners(e)}},{key:"componentWillReceiveProps",value:function(e){var t=this;e.trade!==this.props.trade&&(this.setState(new f),setTimeout(function(){t.getPaymentsList(e.trade)},300),this.initListeners(e.trade))}},{key:"componentWillUnmount",value:function(){window.clearInterval(this.smsTimer),this.props.trade.dispose()}},{key:"getPaymentsList",value:function(e){var t=this;if(e){var n=this.pid+=1;e.getPaymentsList(function(e){t.pid===n&&t.setPayments(e)})}}},{key:"initListeners",value:function(e){var t=this;e&&e.on("payInited",function(e,n){t.setState(U({},n))}).on("paySuccess",function(){t.setState({isInProgress:!1,error:null}),t.props.onSuccess()}).on("payCancel",function(){t.setState({isInProgress:!1,chosePaymentName:null})}).on("payFail",function(e){var n=e;"object"!==(void 0===e?"undefined":B(e))||e instanceof Error||(n=e.message),t.setState({isInProgress:!1,error:n}),t.props.onFail(e)}).on("needSMS",function(e){t.setState({isInProgress:!1,error:null,needSMS:e.message,passcode:""})}).on("needWechatCode",function(){t.props.onError("needWechatCode")}).on("error",function(e,n){t.props.onError(e,n)})}},{key:"startSMSTimer",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:60;window.clearInterval(this.smsTimer),this.setState({smsTimer:t}),this.smsTimer=window.setInterval(function(){t-=1,t<=0?(window.clearInterval(e.smsTimer),e.smsTimer=null,e.setState({smsTimer:0})):e.setState({smsTimer:t})},1e3)}},{key:"payWithBalance",value:function(e){return 6!==e.length?(this.setState({error:"请输入 6 位支付密码"}),!1):(this.setState({isInProgress:!0,error:null}),this.props.trade.payWithBalance(e))}},{key:"renderPaymentsList",value:function(){var e=this,t=this.state,n=t.payments,o=t.chosePaymentName,a=t.choseName,r=this.props.trade;if(o)return null;var i=n.balance&&n.balance.amount,s=r.info.total,c=n.wechat&&n.wechat.enable,l=n.balance&&n.balance.enable,u=n.balance&&!n.balance.enable,m=i>=s?"使用余额（剩余 "+(i/100).toFixed(2)+"）":"微信支付",p=i>=s?"wallet":"wechatPayment",d="PaymentItem-"+(i>=s?"wallet":"wechatPayment");a&&(m="wechat"===a?"微信支付":"使用余额（剩余 "+(i/100).toFixed(2)+"）",p="wechat"===a?"wechatPayment":"wallet",d="PaymentItem-"+("wechat"===a?"wechatPayment":"wallet"));var f=C.a.createElement("div",null,C.a.createElement(T.a,{name:p,className:d}),C.a.createElement(P.c,{className:"Payment-Popover"},m),C.a.createElement(T.a,{className:"Select-arrow",name:"select"}));return C.a.createElement("div",{className:"PaymentsList"},C.a.createElement("span",{className:"Payment-Topline"}),C.a.createElement("span",{className:"PaymentWay"},"支付方式"),C.a.createElement(F.a,{placeholder:f},C.a.createElement(_.b,{plain:!0,className:"Payment-select",listClassName:"Payment-select-list",targetClassName:"Popover-targetContainer-verification",text:i>=s?"使用余额（剩余 "+(i/100).toFixed(2)+"）":"微信支付",menuToggler:f,onChange:function(t){"disabled"!==t&&e.setState({choseName:t})}},l&&C.a.createElement(_.a,{value:"balance",className:"PaymentItem"},C.a.createElement(T.a,{name:"wallet",className:"PaymentItem-wallet"}),"使用余额（剩余 "+(i/100).toFixed(2)+"）"),u&&C.a.createElement(_.a,{value:"disabled",className:"PaymentItem PaymentItem--disabled"},C.a.createElement(T.a,{name:"wallet",className:"PaymentItem-wallet"}),"使用余额（剩余 "+(i/100).toFixed(2)+"）"),c&&C.a.createElement(_.a,{value:"wechat",className:"PaymentItem"},C.a.createElement(T.a,{name:"wechatPayment",className:"PaymentItem-wechatPayment"}),"微信支付"))),C.a.createElement("span",{className:"Payment-Bottomline"}),C.a.createElement(P.c,{className:"Payment-CheckedButton",onClick:this.confirmPayment},"确认支付"))}},{key:"render",value:function(){var e=this,t=this.props,n=t.className,o=t.trade,a=this.state,r=a.payments,i=a.chosePaymentName,s=a.codeUrl,c=a.needSMS,l=a.isInProgress;return o?C.a.createElement("div",{className:O()("Payment",n)},Object.keys(r).length?this.renderPaymentsList():C.a.createElement("div",{className:"Payment-placeholder"},C.a.createElement(M,null)),"wechat"===i&&C.a.createElement("div",{className:"Payment-wechatPay"},C.a.createElement("div",{className:"Payment-wechatPayTitle"},C.a.createElement("i",{className:"icon icon-ic_wechatpay PaymentIconWechat"}),"微信支付"),!this.isInWechat&&C.a.createElement("div",null,"使用微信扫描二维码完成支付"),this.state.qrLoaded?C.a.createElement("span",{className:"Payment-qrWrapper"},C.a.createElement("img",{role:"presentation",src:"//www.zhihu.com/qrcode?url="+s,width:"150",height:"150"})):C.a.createElement("div",{className:"Payment-qrPlaceholder"},C.a.createElement(M,null),!this.isInWechat&&C.a.createElement("div",null,"正在生成二维码"),s&&C.a.createElement("img",{role:"presentation",src:"//www.zhihu.com/qrcode?url="+s,width:"1",height:"1",onLoad:this.onQrLoad}))),"balance"===i&&C.a.createElement("form",{onSubmit:this.onBalanceFormSubmit,className:"Payment-balancePay"},C.a.createElement("div",{className:"Payment-balancePayTitle"},C.a.createElement("i",{className:"icon icon-wallet PaymentIconWallet"}),"余额支付"),!c&&C.a.createElement("div",null,C.a.createElement("div",{className:"Payment-description"},"请输入 6 位数知乎支付密码，用于支付验证。"),C.a.createElement(L,{chars:this.state.passcode,onFocus:this.onPasscodeFocus,onChange:this.onPasscodeInput,maskChar:!0,onFinish:this.onPasscodeFinish,className:O()("Payment-tpass",{"Payment-errorInput":this.state.error,"Payment-progressing":l}),autoFocus:!0,ref:function(t){e.tpass=t}},l&&C.a.createElement(M,{className:"Payment-balancePaySpinner"}))),Boolean(c)&&C.a.createElement("div",{className:"Payment-balancePaySms"},C.a.createElement("div",{className:"Payment-balancePaySmsText"},String(c)),C.a.createElement("input",{onChange:this.onPasscodeInput,value:this.state.passcode,className:O()("Payment-sms","SimpleInput",{"Payment-errorInput":this.state.error}),type:"text",pattern:"\\d{6}",minLength:"6",maxLength:"6",title:"验证码应为 6 位数字",placeholder:"输入 6 位数验证码",required:!0,autoFocus:!0,ref:function(t){e.smsInput=t}}),this.state.smsTimer?C.a.createElement("button",{className:"Payment-sendSms",type:"button",disabled:!0},this.state.smsTimer," 秒后可重发"):C.a.createElement("button",{onClick:this.onSendSMSCode,className:"Payment-sendSms",type:"button"},"发送验证码")),C.a.createElement("div",{className:"Payment-balancePayFooter"},C.a.createElement("p",{className:"Payment-errorTip",style:{visibility:this.state.error?"visible":"hidden"}},this.state.error),Boolean(c)&&C.a.createElement(P.c,{color:"blue",disabled:l,className:"Payment-balancePayConfirmBtn",type:"submit"},"确认")),!c&&C.a.createElement("div",{className:"Payment-balancePayForget"},"如果忘记密码请邮件联系"," ",C.a.createElement("email",{className:"Payment-email"},"i@zhihu.com")))):C.a.createElement("div",{className:O()("Payment",n)},C.a.createElement("div",{className:"Payment-placeholder Payment-placehoder--empty"},C.a.createElement(M,null)))}}]),t}(C.a.Component);q.propTypes={trade:w.a.object,autoChooseSinglePayment:w.a.bool,onSuccess:w.a.func.isRequired,onFail:w.a.func,onError:w.a.func,onConfirmPayment:w.a.func},q.defaultProps={trade:null,onSuccess:function(){},onFail:function(){},onError:function(){},autoChooseSinglePayment:!0,className:""};var z=q,W=n(221),G="",K=null,H=n(8);n(1419);n.d(t,"TipjarDialog",function(){return X});var $,J,Y=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),Z=[200,500,1e3,5e3,1e4,2e4],Q=100,X=(J=$=function(e){function t(e){v(this,t);var n=y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return n.onConfirmPayment=function(e){n.setState({chosePaymentName:e})},n.onPaySuccess=function(){n.props.onPaySuccess(),n.setState({chosePaymentName:!0,colseTijarDialogStatus:!0,trade:void 0,currentAmount:"",customButton:!1})},n.handleCustomAmount=function(){n.state.trade&&n.state.trade.dispose(),n.setState({showCustom:!0})},n.handleCustomChange=function(e){var t=e.target.value;Number(t)?n.setState({customAmount:Number(t)}):t.length||n.setState({customAmount:""})},n.handleCustomKeyUp=function(e){13===e.keyCode&&n.handleSubmitCustom()},n.handleSubmitCustom=function(){var e=n.state.customAmount*Q;e>0&&e<5e4&&(n.setState({customButton:!0,showCustom:!1,colseTijarDialogStatus:!1}),n.createTrade(e))},n.closeModal=function(){n.state.trade&&n.state.trade.dispose(),n.setState(n.getDefaultState())},n.handleAmountButton=function(e){n.createTrade(e.currentTarget.dataset.amount),n.setState({colseTijarDialogStatus:!1,customButton:!1,showCustom:!1})},n.createTrade=function(e){n.setState({tradeLoading:!0,currentAmount:e});var t=n.props.ua;n.props.addReward(e,t.Wechat?"wechat":"normal"),n.setState({tradeLoading:!1})},n.colseTijarDialog=function(){n.setState({chosePaymentName:!0,colseTijarDialogStatus:!0,trade:void 0,currentAmount:""}),n.props.colseTijarDialog()},n.state=n.getDefaultState(),n}return b(t,e),Y(t,[{key:"componentDidMount",value:function(){this.showTip()}},{key:"componentDidUpdate",value:function(){var e=this.props,t=e.tradeNumber,n=e.type,o=this.state,a=o.trade,r=o.colseTijarDialogStatus,i="article"===n?11:17;if(t&&(!a||t!==a.tradeNo)&&!r){var s=new window.zhihu.pay.Trade(t,i);this.setState({trade:s})}}},{key:"componentWillUnmount",value:function(){this.props.TipjarRender&&this.props.removeTradeNumber()}},{key:"getDefaultState",value:function(){return{showCustom:!1,customAmount:"",currentAmount:"",showTipModal:!1,customButton:!1,chosePaymentName:!0,colseTijarDialogStatus:!1}}},{key:"showTip",value:function(){var e=this;h("https://pay.zhihu.com/api/js",function(){e.setState({showTipModal:!0})})}},{key:"renderAmountCustom",value:function(){var e=this.state,t=e.showCustom,n=e.customAmount,o=e.currentAmount,a=e.customButton;return C.a.createElement("div",{className:"Reward-TipjarDialog-amountCustom"},t?C.a.createElement("div",{className:"Reward-TipjarDialog-amountInput"},C.a.createElement("input",{name:"",type:"text",className:"SimpleInput",placeholder:"你想赞赏的金额（不超过 500）",value:n,onChange:this.handleCustomChange,onKeyUp:this.handleCustomKeyUp,ref:function(e){e&&e.focus()}}),C.a.createElement(P.c,{disabled:n<=0||n>500,color:"blue",preset:"primary",onClick:this.handleSubmitCustom},"确定"),C.a.createElement("div",{className:"Reward-TipjarDialog-error",style:{display:n>500?"block":"none"}},"不能超过 500 元")):C.a.createElement(P.c,{preset:"plain",className:a?"TipjarDialog-customButton-cheked":"TipjarDialog-customButton",onClick:this.handleCustomAmount},a?"自定义金额： ￥ "+o/Q:"自定义金额"))}},{key:"renderTipjarDialog",value:function(){var e=this,t=this.props,n=t.author,o=n.name,a=n.avatarUrl,r=n.isOrg,i=n.urlToken,s=n.id,c=t.tagline,l=this.state.currentAmount;return C.a.createElement("div",{className:"Reward-TipjarDialog"},C.a.createElement("div",{className:"Reward-TipjarDialog-user"},C.a.createElement("a",{href:"/"+(r?"org":"people")+"/"+(i||s),className:"Reward-UserAvatar"},C.a.createElement("img",{src:a.replace("_is","_l"),className:"Reward-Avatar",alt:"当前用户"})),o),C.a.createElement("div",{className:"Reward-TipjarDialog-tagLine"},c),C.a.createElement("div",{className:"Reward-TipjarDialog-selectAmount"},C.a.createElement("div",{className:"Reward-TipjarDialog-amountList"},Z.map(function(t){return C.a.createElement(P.c,{key:t,"data-amount":t,onClick:e.handleAmountButton,color:"red",className:O()({"Reward-Button-checked":Number(l)===t})},C.a.createElement("b",null,Number(l)===t?t/Q+" 元":"￥ "+t/Q))})),this.renderAmountCustom()))}},{key:"render",value:function(){var e=this.props,t=e.ua,n=e.TipjarRender,o=e.isMobile,a=this.state,r=a.showCustom,i=a.tradeLoading,s=a.showTipModal,c=a.trade,l=a.chosePaymentName,u=o?S.a:I.b,m=o?"small":"default";return C.a.createElement(u,{overlay:!0,size:m,onClose:this.colseTijarDialog,className:"Reward-TipjarDialogModal"},n&&C.a.createElement("div",null,s&&l&&this.renderTipjarDialog(),(c||i)&&!r&&C.a.createElement(z,{trade:c,ua:t,onSuccess:this.onPaySuccess,onConfirmPayment:this.onConfirmPayment})))}}]),t}(g.Component),$.propTypes={author:w.a.object,tagline:w.a.string,colseTijarDialog:w.a.func,addReward:w.a.func,tradeNumber:w.a.number,removeTradeNumber:w.a.func,onPaySuccess:w.a.func,isMobile:w.a.bool,type:w.a.string},$.defaultProps={tagline:H.h},J)}});
//# sourceMappingURL=column.modals.2b6cf6ba6e14a672b0c1.js.map